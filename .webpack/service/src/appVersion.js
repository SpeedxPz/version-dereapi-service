!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=114)}([function(t,e){t.exports=require("util")},,,,function(t,e,n){"undefined"==typeof process||"renderer"===process.type||!0===process.browser||process.__nwjs?t.exports=n(43):t.exports=n(45)},,,,,function(t,e,n){"use strict";const r=n(0);function i(t,e){function n(n){Error.call(this),Error.captureStackTrace(this,this.constructor),this.name=e,this.message=n||t}return r.inherits(n,Error),n}t.exports={SchemaError:new i("Error with schema","SchemaError"),ModelError:new i("Error with model","ModelError"),QueryError:new i("Error with query","QueryError"),ScanError:new i("Error with scan","ScanError"),TransactionError:new i("Error with transaction","TransactionError"),ValidationError:new i("Validation error","ValidationError"),ParseError:new i("Parse error","ParseError")}},function(t,e,n){
/*!
 *
 * Copyright 2009-2017 Kris Kowal under the terms of the MIT
 * license found at https://github.com/kriskowal/q/blob/v1/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
!function(e){"use strict";"function"==typeof bootstrap?bootstrap("promise",e):t.exports=e()}((function(){"use strict";var t=!1;try{throw new Error}catch(e){t=!!e.stack}var e,n=T(),r=function(){},i=function(){var t={task:void 0,next:null},e=t,n=!1,r=void 0,o=!1,s=[];function a(){for(var e,r;t.next;)e=(t=t.next).task,t.task=void 0,(r=t.domain)&&(t.domain=void 0,r.enter()),u(e,r);for(;s.length;)u(e=s.pop());n=!1}function u(t,e){try{t()}catch(t){if(o)throw e&&e.exit(),setTimeout(a,0),e&&e.enter(),t;setTimeout((function(){throw t}),0)}e&&e.exit()}if(i=function(t){e=e.next={task:t,domain:o&&process.domain,next:null},n||(n=!0,r())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)o=!0,r=function(){process.nextTick(a)};else if("function"==typeof setImmediate)r="undefined"!=typeof window?setImmediate.bind(window,a):function(){setImmediate(a)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=function(){r=p,c.port1.onmessage=a,a()};var p=function(){c.port2.postMessage(0)};r=function(){setTimeout(a,0),p()}}else r=function(){setTimeout(a,0)};return i.runAfter=function(t){s.push(t),n||(n=!0,r())},i}(),o=Function.call;function s(t){return function(){return o.apply(t,arguments)}}var a,u=s(Array.prototype.slice),c=s(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;n<r;n++)n in this&&(e=t(e,this[n],n));return e}),p=s(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),l=s(Array.prototype.map||function(t,e){var n=this,r=[];return c(n,(function(i,o,s){r.push(t.call(e,o,s,n))}),void 0),r}),h=Object.create||function(t){function e(){}return e.prototype=t,new e},f=Object.defineProperty||function(t,e,n){return t[e]=n.value,t},d=s(Object.prototype.hasOwnProperty),y=Object.keys||function(t){var e=[];for(var n in t)d(t,n)&&e.push(n);return e},m=s(Object.prototype.toString);function E(t){return"[object StopIteration]"===m(t)||t instanceof a}a="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};function b(e,n){if(t&&n.stack&&"object"==typeof e&&null!==e&&e.stack){for(var r=[],i=n;i;i=i.source)i.stack&&(!e.__minimumStackCounter__||e.__minimumStackCounter__>i.stackCounter)&&(f(e,"__minimumStackCounter__",{value:i.stackCounter,configurable:!0}),r.unshift(i.stack));r.unshift(e.stack);var o=function(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var i=e[r];!g(i)&&(-1===(o=i).indexOf("(module.js:")&&-1===o.indexOf("(node.js:"))&&i&&n.push(i)}var o;return n.join("\n")}(r.join("\nFrom previous event:\n"));f(e,"stack",{value:o,configurable:!0})}}function v(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function g(t){var r=v(t);if(!r)return!1;var i=r[0],o=r[1];return i===e&&o>=n&&o<=W}function T(){if(t)try{throw new Error}catch(t){var n=t.stack.split("\n"),r=v(n[0].indexOf("@")>0?n[1]:n[2]);if(!r)return;return e=r[0],r[1]}}function S(t){return t instanceof O?t:D(t)?function(t){var e=w();return S.nextTick((function(){try{t.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}})),e.promise}(t):M(t)}S.resolve=S,S.nextTick=i,S.longStackSupport=!1;var A=1;function w(){var e,n=[],r=[],i=h(w.prototype),o=h(O.prototype);if(o.promiseDispatch=function(t,i,o){var s=u(arguments);n?(n.push(s),"when"===i&&o[1]&&r.push(o[1])):S.nextTick((function(){e.promiseDispatch.apply(e,s)}))},o.valueOf=function(){if(n)return o;var t=R(e);return x(t)&&(e=t),t},o.inspect=function(){return e?e.inspect():{state:"pending"}},S.longStackSupport&&t)try{throw new Error}catch(t){o.stack=t.stack.substring(t.stack.indexOf("\n")+1),o.stackCounter=A++}function s(i){e=i,S.longStackSupport&&t&&(o.source=i),c(n,(function(t,e){S.nextTick((function(){i.promiseDispatch.apply(i,e)}))}),void 0),n=void 0,r=void 0}return i.promise=o,i.resolve=function(t){e||s(S(t))},i.fulfill=function(t){e||s(M(t))},i.reject=function(t){e||s(F(t))},i.notify=function(t){e||c(r,(function(e,n){S.nextTick((function(){n(t)}))}),void 0)},i}function I(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=w();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function N(t){return I((function(e,n){for(var r=0,i=t.length;r<i;r++)S(t[r]).then(e,n)}))}function O(t,e,n){void 0===e&&(e=function(t){return F(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=h(O.prototype);if(r.promiseDispatch=function(n,i,o){var s;try{s=t[i]?t[i].apply(r,o):e.call(r,i,o)}catch(t){s=F(t)}n&&n(s)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?r:t.value}}return r}function C(t,e,n,r){return S(t).then(e,n,r)}function R(t){if(x(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function x(t){return t instanceof O}function D(t){return(e=t)===Object(e)&&"function"==typeof t.then;var e}"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(S.longStackSupport=!0),S.defer=w,w.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(u(arguments,1)):t.resolve(n)}},S.Promise=I,S.promise=I,I.race=N,I.all=G,I.reject=F,I.resolve=S,S.passByCopy=function(t){return t},O.prototype.passByCopy=function(){return this},S.join=function(t,e){return S(t).join(e)},O.prototype.join=function(t){return S([this,t]).spread((function(t,e){if(t===e)return t;throw new Error("Q can't join: not the same: "+t+" "+e)}))},S.race=N,O.prototype.race=function(){return this.then(S.race)},S.makePromise=O,O.prototype.toString=function(){return"[object Promise]"},O.prototype.then=function(t,e,n){var r=this,i=w(),o=!1;return S.nextTick((function(){r.promiseDispatch((function(e){o||(o=!0,i.resolve(function(e){try{return"function"==typeof t?t(e):e}catch(t){return F(t)}}(e)))}),"when",[function(t){o||(o=!0,i.resolve(function(t){if("function"==typeof e){b(t,r);try{return e(t)}catch(t){return F(t)}}return F(t)}(t)))}])})),r.promiseDispatch(void 0,"when",[void 0,function(t){var e,r=!1;try{e=function(t){return"function"==typeof n?n(t):t}(t)}catch(t){if(r=!0,!S.onerror)throw t;S.onerror(t)}r||i.notify(e)}]),i.promise},S.tap=function(t,e){return S(t).tap(e)},O.prototype.tap=function(t){return t=S(t),this.then((function(e){return t.fcall(e).thenResolve(e)}))},S.when=C,O.prototype.thenResolve=function(t){return this.then((function(){return t}))},S.thenResolve=function(t,e){return S(t).thenResolve(e)},O.prototype.thenReject=function(t){return this.then((function(){throw t}))},S.thenReject=function(t,e){return S(t).thenReject(e)},S.nearer=R,S.isPromise=x,S.isPromiseAlike=D,S.isPending=function(t){return x(t)&&"pending"===t.inspect().state},O.prototype.isPending=function(){return"pending"===this.inspect().state},S.isFulfilled=function(t){return!x(t)||"fulfilled"===t.inspect().state},O.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},S.isRejected=function(t){return x(t)&&"rejected"===t.inspect().state},O.prototype.isRejected=function(){return"rejected"===this.inspect().state};var _,L,j,U=[],K=[],P=[],k=!0;function $(){U.length=0,K.length=0,k||(k=!0)}function F(t){var e=O({when:function(e){return e&&function(t){if(k){var e=p(K,t);-1!==e&&("object"==typeof process&&"function"==typeof process.emit&&S.nextTick.runAfter((function(){var n=p(P,t);-1!==n&&(process.emit("rejectionHandled",U[e],t),P.splice(n,1))})),K.splice(e,1),U.splice(e,1))}}(this),e?e(t):this}},(function(){return this}),(function(){return{state:"rejected",reason:t}}));return function(t,e){k&&("object"==typeof process&&"function"==typeof process.emit&&S.nextTick.runAfter((function(){-1!==p(K,t)&&(process.emit("unhandledRejection",e,t),P.push(t))})),K.push(t),e&&void 0!==e.stack?U.push(e.stack):U.push("(no stack) "+e))}(e,t),e}function M(t){return O({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},delete:function(e){delete t[e]},post:function(e,n){return null==e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return y(t)}},void 0,(function(){return{state:"fulfilled",value:t}}))}function V(t,e,n){return S(t).spread(e,n)}function q(t,e,n){return S(t).dispatch(e,n)}function G(t){return C(t,(function(t){var e=0,n=w();return c(t,(function(r,i,o){var s;x(i)&&"fulfilled"===(s=i.inspect()).state?t[o]=s.value:(++e,C(i,(function(r){t[o]=r,0==--e&&n.resolve(t)}),n.reject,(function(t){n.notify({index:o,value:t})})))}),void 0),0===e&&n.resolve(t),n.promise}))}function B(t){if(0===t.length)return S.resolve();var e=S.defer(),n=0;return c(t,(function(r,i,o){var s=t[o];n++,C(s,(function(t){e.resolve(t)}),(function(t){if(0===--n){var r=t||new Error(""+t);r.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+r.message,e.reject(r)}}),(function(t){e.notify({index:o,value:t})}))}),void 0),e.promise}function H(t){return C(t,(function(t){return t=l(t,S),C(G(l(t,(function(t){return C(t,r,r)}))),(function(){return t}))}))}S.resetUnhandledRejections=$,S.getUnhandledReasons=function(){return U.slice()},S.stopUnhandledRejectionTracking=function(){$(),k=!1},$(),S.reject=F,S.fulfill=M,S.master=function(t){return O({isDef:function(){}},(function(e,n){return q(t,e,n)}),(function(){return S(t).inspect()}))},S.spread=V,O.prototype.spread=function(t,e){return this.all().then((function(e){return t.apply(void 0,e)}),e)},S.async=function(t){return function(){function e(t,e){var o;if("undefined"==typeof StopIteration){try{o=n[t](e)}catch(t){return F(t)}return o.done?S(o.value):C(o.value,r,i)}try{o=n[t](e)}catch(t){return E(t)?S(t.value):F(t)}return C(o,r,i)}var n=t.apply(this,arguments),r=e.bind(e,"next"),i=e.bind(e,"throw");return r()}},S.spawn=function(t){S.done(S.async(t)())},S.return=function(t){throw new a(t)},S.promised=function(t){return function(){return V([this,G(arguments)],(function(e,n){return t.apply(e,n)}))}},S.dispatch=q,O.prototype.dispatch=function(t,e){var n=this,r=w();return S.nextTick((function(){n.promiseDispatch(r.resolve,t,e)})),r.promise},S.get=function(t,e){return S(t).dispatch("get",[e])},O.prototype.get=function(t){return this.dispatch("get",[t])},S.set=function(t,e,n){return S(t).dispatch("set",[e,n])},O.prototype.set=function(t,e){return this.dispatch("set",[t,e])},S.del=S.delete=function(t,e){return S(t).dispatch("delete",[e])},O.prototype.del=O.prototype.delete=function(t){return this.dispatch("delete",[t])},S.mapply=S.post=function(t,e,n){return S(t).dispatch("post",[e,n])},O.prototype.mapply=O.prototype.post=function(t,e){return this.dispatch("post",[t,e])},S.send=S.mcall=S.invoke=function(t,e){return S(t).dispatch("post",[e,u(arguments,2)])},O.prototype.send=O.prototype.mcall=O.prototype.invoke=function(t){return this.dispatch("post",[t,u(arguments,1)])},S.fapply=function(t,e){return S(t).dispatch("apply",[void 0,e])},O.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},S.try=S.fcall=function(t){return S(t).dispatch("apply",[void 0,u(arguments,1)])},O.prototype.fcall=function(){return this.dispatch("apply",[void 0,u(arguments)])},S.fbind=function(t){var e=S(t),n=u(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(u(arguments))])}},O.prototype.fbind=function(){var t=this,e=u(arguments);return function(){return t.dispatch("apply",[this,e.concat(u(arguments))])}},S.keys=function(t){return S(t).dispatch("keys",[])},O.prototype.keys=function(){return this.dispatch("keys",[])},S.all=G,O.prototype.all=function(){return G(this)},S.any=B,O.prototype.any=function(){return B(this)},S.allResolved=(_=H,L="allResolved",j="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(L+" is deprecated, use "+j+" instead.",new Error("").stack),_.apply(_,arguments)}),O.prototype.allResolved=function(){return H(this)},S.allSettled=function(t){return S(t).allSettled()},O.prototype.allSettled=function(){return this.then((function(t){return G(l(t,(function(t){function e(){return t.inspect()}return(t=S(t)).then(e,e)})))}))},S.fail=S.catch=function(t,e){return S(t).then(void 0,e)},O.prototype.fail=O.prototype.catch=function(t){return this.then(void 0,t)},S.progress=function(t,e){return S(t).then(void 0,void 0,e)},O.prototype.progress=function(t){return this.then(void 0,void 0,t)},S.fin=S.finally=function(t,e){return S(t).finally(e)},O.prototype.fin=O.prototype.finally=function(t){if(!t||"function"!=typeof t.apply)throw new Error("Q can't apply finally callback");return t=S(t),this.then((function(e){return t.fcall().then((function(){return e}))}),(function(e){return t.fcall().then((function(){throw e}))}))},S.done=function(t,e,n,r){return S(t).done(e,n,r)},O.prototype.done=function(t,e,n){var r=function(t){S.nextTick((function(){if(b(t,i),!S.onerror)throw t;S.onerror(t)}))},i=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),i.then(void 0,r)},S.timeout=function(t,e,n){return S(t).timeout(e,n)},O.prototype.timeout=function(t,e){var n=w(),r=setTimeout((function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),n.reject(e)}),t);return this.then((function(t){clearTimeout(r),n.resolve(t)}),(function(t){clearTimeout(r),n.reject(t)}),n.notify),n.promise},S.delay=function(t,e){return void 0===e&&(e=t,t=void 0),S(t).delay(e)},O.prototype.delay=function(t){return this.then((function(e){var n=w();return setTimeout((function(){n.resolve(e)}),t),n.promise}))},S.nfapply=function(t,e){return S(t).nfapply(e)},O.prototype.nfapply=function(t){var e=w(),n=u(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},S.nfcall=function(t){var e=u(arguments,1);return S(t).nfapply(e)},O.prototype.nfcall=function(){var t=u(arguments),e=w();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},S.nfbind=S.denodeify=function(t){if(void 0===t)throw new Error("Q can't wrap an undefined function");var e=u(arguments,1);return function(){var n=e.concat(u(arguments)),r=w();return n.push(r.makeNodeResolver()),S(t).fapply(n).fail(r.reject),r.promise}},O.prototype.nfbind=O.prototype.denodeify=function(){var t=u(arguments);return t.unshift(this),S.denodeify.apply(void 0,t)},S.nbind=function(t,e){var n=u(arguments,2);return function(){var r=n.concat(u(arguments)),i=w();function o(){return t.apply(e,arguments)}return r.push(i.makeNodeResolver()),S(o).fapply(r).fail(i.reject),i.promise}},O.prototype.nbind=function(){var t=u(arguments,0);return t.unshift(this),S.nbind.apply(void 0,t)},S.nmapply=S.npost=function(t,e,n){return S(t).npost(e,n)},O.prototype.nmapply=O.prototype.npost=function(t,e){var n=u(e||[]),r=w();return n.push(r.makeNodeResolver()),this.dispatch("post",[t,n]).fail(r.reject),r.promise},S.nsend=S.nmcall=S.ninvoke=function(t,e){var n=u(arguments,2),r=w();return n.push(r.makeNodeResolver()),S(t).dispatch("post",[e,n]).fail(r.reject),r.promise},O.prototype.nsend=O.prototype.nmcall=O.prototype.ninvoke=function(t){var e=u(arguments,1),n=w();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},S.nodeify=function(t,e){return S(t).nodeify(e)},O.prototype.nodeify=function(t){if(!t)return this;this.then((function(e){S.nextTick((function(){t(null,e)}))}),(function(e){S.nextTick((function(){t(e)}))}))},S.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var W=T();return S}))},,,,,,,function(t,e){t.exports=require("https")},function(t,e,n){"use strict";const r=n(41);r.default,t.exports=r.default},,,function(t,e,n){"use strict";var r=n(18),i=n.n(r);e.a=t=>i.a.model(t,{id:String,appId:String,platform:String,version:String,updateTime:Number,appInfo:{name:String,image:String,author:String}})},function(t,e,n){t.exports=function(t){function e(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return r.colors[Math.abs(e)%r.colors.length]}function r(t){let n;function s(...t){if(!s.enabled)return;const e=s,i=Number(new Date),o=i-(n||i);e.diff=o,e.prev=n,e.curr=i,n=i,t[0]=r.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(n,i)=>{if("%%"===n)return n;a++;const o=r.formatters[i];if("function"==typeof o){const r=t[a];n=o.call(e,r),t.splice(a,1),a--}return n}),r.formatArgs.call(e,t),(e.log||r.log).apply(e,t)}return s.namespace=t,s.enabled=r.enabled(t),s.useColors=r.useColors(),s.color=e(t),s.destroy=i,s.extend=o,"function"==typeof r.init&&r.init(s),r.instances.push(s),s}function i(){const t=r.instances.indexOf(this);return-1!==t&&(r.instances.splice(t,1),!0)}function o(t,e){const n=r(this.namespace+(void 0===e?":":e)+t);return n.log=this.log,n}function s(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},r.disable=function(){const t=[...r.names.map(s),...r.skips.map(s).map(t=>"-"+t)].join(",");return r.enable(""),t},r.enable=function(t){let e;r.save(t),r.names=[],r.skips=[];const n=("string"==typeof t?t:"").split(/[\s,]+/),i=n.length;for(e=0;e<i;e++)n[e]&&("-"===(t=n[e].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$")));for(e=0;e<r.instances.length;e++){const t=r.instances[e];t.enabled=r.enabled(t.namespace)}},r.enabled=function(t){if("*"===t[t.length-1])return!0;let e,n;for(e=0,n=r.skips.length;e<n;e++)if(r.skips[e].test(t))return!1;for(e=0,n=r.names.length;e<n;e++)if(r.names[e].test(t))return!0;return!1},r.humanize=n(44),Object.keys(t).forEach(e=>{r[e]=t[e]}),r.instances=[],r.names=[],r.skips=[],r.formatters={},r.selectColor=e,r.enable(r.load()),r}},function(t,e,n){"use strict";const r=n(10),i=n(4)("dynamoose:table"),o=n(50);function s(t,e,n,r){i("new Table (%s)",t,e),this.name=t,this.schema=e,this.options=n||{},this.base=r,void 0!==this.options.create&&null!==this.options.create||(this.options.create=!0)}s.prototype.deleteIndex=function(t){const e=r.defer();this.active=!1;const n={TableName:this.name,GlobalSecondaryIndexUpdates:[{Delete:{IndexName:t}}]};return this.base.ddb().updateTable(n,(t,n)=>{i("deleteIndex handler running"),t?e.reject(t):setTimeout(()=>{this.waitForActive().then(()=>{e.resolve(n)})},300)}),e.promise},s.prototype.createIndex=function(t,e){const n=r.defer();this.active=!1;const i={TableName:this.name,AttributeDefinitions:t,GlobalSecondaryIndexUpdates:[{Create:e}]};return this.base.ddb().updateTable(i,(t,e)=>{t?n.reject(t):setTimeout(()=>{this.waitForActive().then(()=>{n.resolve(e)})},300)}),n.promise},s.prototype.init=function(t){i("initializing table, %s, %j",this.name,this.options);const e=r.defer();let n;return this.options.create?(this.describe().then(t=>{i("table exist -- initialization done"),n=this.buildTableReq(this.name,this.schema);const s=function(t,e){const n={delete:[],create:[]},r=e;let s,a;const u=t.GlobalSecondaryIndexes||[],c=r.GlobalSecondaryIndexes||[];for(i("compareIndexes"),s=0;s<u.length;s+=1){let t=!1;for(a=0;a<c.length;a+=1)if(c[a].IndexName===u[s].IndexName){const e=(({IndexName:t,KeySchema:e,Projection:n})=>({IndexName:t,KeySchema:e,Projection:n}))(u[s]);Array.isArray(e&&e.Projection&&e.Projection.NonKeyAttributes)&&e.Projection.NonKeyAttributes.sort();const r=(({IndexName:t,KeySchema:e,Projection:n})=>({IndexName:t,KeySchema:e,Projection:n}))(c[a]);Array.isArray(r&&r.Projection&&r.Projection.NonKeyAttributes)&&r.Projection.NonKeyAttributes.sort(),i("indexes being compared"),i("local: ",e),i("remote: ",r),o(r,e)?t=!0:(e.ProvisionedThroughput=u[s].ProvisionedThroughput,n.delete.push(e),n.create.push(e),t=!0)}t||n.create.push(u[s])}for(a=0;a<c.length;a+=1){let t=!1;for(s=0;s<u.length;s+=1)c[a].IndexName===u[s].IndexName&&(t=!0);t||n.delete.push(c[a])}return n}(n,t.Table);if(i("%s",JSON.stringify(s,null,2)),this.options.update)i("updating indexes sequentially"),r().then(()=>s.delete.reduce((t,e)=>t.then(()=>this.deleteIndex(e.IndexName)),r())).then(()=>s.create.reduce((t,e)=>t.then(()=>this.createIndex(n.AttributeDefinitions,e)),r())).catch(t=>{i(t)});else if(s.delete.length>0||s.create.length>0){const t=`${this.name} indexes are not synchronized and update flag is set to false`;i(t),e.reject(new Error(t))}return this.initialized=!0,this.waitForActive().then(()=>this.updateTTL()).then(()=>e.resolve())}).catch(t=>t&&"ResourceNotFoundException"===t.code?(i("table does not exist -- creating"),e.resolve(this.create().then(()=>{this.initialized=!0}).then(()=>{if(this.options.waitForActive)return this.waitForActive()}).then(()=>this.updateTTL()))):t?(i("error initializing",t.stack),e.reject(t)):void 0),e.promise.nodeify(t)):(this.initialized=!0,this.updateTTL())},s.prototype.waitForActive=function(t,e){i("Waiting for Active table, %s, %j",this.name,this.options);const n=r.defer();"function"==typeof t&&(e=t,t=null),t||(t=this.options.waitForActiveTimeout);const o=Date.now()+t,s=()=>(i("Waiting..."),Date.now()>o?n.reject(new Error(`Wait for Active timed out after ${t} ms.`)):this.initialized?void this.describe().then(t=>{let e="ACTIVE"===t.Table.TableStatus;(t.Table.GlobalSecondaryIndexes||[]).forEach(t=>{i("index %s.IndexStatus is %s",t.IndexName,t.IndexStatus),"ACTIVE"!==t.IndexStatus&&(e=!1)}),e?(this.active=!0,n.resolve()):(i("Waiting for Active again - %s",this.name),setTimeout(s,500))}).catch(t=>t&&"ResourceNotFoundException"===t.code?setTimeout(s,10):(i("Error waiting for active",t.stack),n.reject(t))):setTimeout(s,10));return s(),n.promise.nodeify(e)},s.prototype.describeTTL=function(t){i("Describing ttl for table, %s",this.name);const e=r.defer(),n=this.base.ddb(),o={TableName:this.name};return n.describeTimeToLive(o,(t,n)=>t?e.reject(t):e.resolve(n)),e.promise.nodeify(t)},s.prototype.updateTTL=function(t){i("Updating ttl for table, %s",this.name);const e=r.defer();return this.schema.expires&&!this.base.endpointURL?this.describeTTL().then(t=>{const n=t.TimeToLiveDescription.TimeToLiveStatus;if("ENABLING"===n||"ENABLED"===n)return e.resolve();const r={TableName:this.name,TimeToLiveSpecification:{AttributeName:this.schema.expires.attribute,Enabled:!0}};this.base.ddb().updateTimeToLive(r,t=>t?e.reject(t):e.resolve())}):e.resolve(),e.promise.nodeify(t)},s.prototype.describe=function(t){const e={TableName:this.name},n=r.defer();return this.base.ddb().describeTable(e,(t,e)=>{if(t)return i("error describing table",t),n.reject(t);n.resolve(e)}),n.promise.nodeify(t)},s.prototype.buildTableReq=function(t,e){const n=[],r={};function o(t){t&&(r[t.name]=t)}o(e.hashKey),o(e.rangeKey);for(const t in e.indexes.global){o(e.indexes.global[t]);const n=e.indexes.global[t].indexes[t].rangeKey;o(e.attributes[n])}for(const t in e.indexes.local)o(e.indexes.local[t]);for(const t in r)n.push({AttributeName:t,AttributeType:r[t].type.dynamo});const s=[{AttributeName:e.hashKey.name,KeyType:"HASH"}];e.rangeKey&&s.push({AttributeName:e.rangeKey.name,KeyType:"RANGE"});const a={AttributeDefinitions:n,TableName:t,KeySchema:s};if("ON_DEMAND"===e.throughput)i(`Using PAY_PER_REQUEST BillingMode for ${t} table creation`),a.BillingMode="PAY_PER_REQUEST";else{i(`Using PROVISIONED BillingMode for ${t} table creation`);const n={ReadCapacityUnits:e.throughput.read,WriteCapacityUnits:e.throughput.write};a.ProvisionedThroughput=n,a.BillingMode="PROVISIONED"}let u,c,p;i("Creating table local indexes",e.indexes.local);for(const t in e.indexes.local){c=c||[];const n=e.indexes.local[t];u=n.indexes[t];const r={IndexName:t,KeySchema:[{AttributeName:e.hashKey.name,KeyType:"HASH"},{AttributeName:n.name,KeyType:"RANGE"}]};u.project?Array.isArray(u.project)?r.Projection={ProjectionType:"INCLUDE",NonKeyAttributes:u.project}:r.Projection={ProjectionType:"ALL"}:r.Projection={ProjectionType:"KEYS_ONLY"},c.push(r)}for(const t in e.indexes.global){p=p||[];const n=e.indexes.global[t];u=n.indexes[t];const r={IndexName:t,KeySchema:[{AttributeName:n.name,KeyType:"HASH"}]};if("PROVISIONED"===a.BillingMode){const t={ReadCapacityUnits:u.throughput.read,WriteCapacityUnits:u.throughput.write};r.ProvisionedThroughput=t}u.rangeKey&&r.KeySchema.push({AttributeName:u.rangeKey,KeyType:"RANGE"}),u.project?Array.isArray(u.project)?r.Projection={ProjectionType:"INCLUDE",NonKeyAttributes:u.project}:r.Projection={ProjectionType:"ALL"}:r.Projection={ProjectionType:"KEYS_ONLY"},p.push(r)}return c&&(a.LocalSecondaryIndexes=c),p&&(a.GlobalSecondaryIndexes=p),this&&this.options&&(this.options.streamOptions&&!0===this.options.streamOptions.enabled&&(a.StreamSpecification={StreamEnabled:!0,StreamViewType:this.options.streamOptions.type}),this.options.serverSideEncryption&&(a.SSESpecification={Enabled:!0})),a},s.prototype.create=function(t){const e=this.base.ddb(),{schema:n}=this,o=this.buildTableReq(this.name,n);i("ddb.createTable request:",o);const s=r.defer();return e.createTable(o,(t,e)=>{if(t)return i("error creating table",t),s.reject(t);i("table created",e),s.resolve(e)}),s.promise.nodeify(t)},s.prototype.delete=function(t){const e={TableName:this.name};i("ddb.deleteTable request:",e);const n=this.base.ddb(),o=r.defer();return n.deleteTable(e,(t,e)=>{if(t)return i("error deleting table",t),o.reject(t);i("deleted table",e),o.resolve(e)}),o.promise.nodeify(t)},s.prototype.update=function(t){const e=r.defer();return e.reject(new Error("TODO")),e.promise.nodeify(t)},t.exports=s},function(t,e,n){"use strict";const r=n(4)("dynamoose:attribute"),i=n(9);function o(e,n,o){if(this.options={},r("Creating attribute %s %o",n,o),o.type&&(this.options=o),this.schema=e,this.name=n,this.schema.options.saveUnknown?this.setTypeFromRawValue(o):this.setType(o),e.useDocumentTypes||("map"===this.type.name?(r("Overwriting attribute %s type to object",n),this.type=this.types.object):"list"===this.type.name&&(r("Overwriting attribute %s type to array",n),this.type=this.types.array)),e.useNativeBooleans&&"boolean"===this.type.name&&(r("Overwriting attribute %s type to be a native boolean",n),this.type=this.types.nativeBoolean),this.attributes={},"map"===this.type.name){if(o.type){if(!o.map)throw new i.SchemaError(`No map schema given for attribute: ${this.name}`);o=o.map}for(const n in o){if(this.attributes[n])throw new i.SchemaError(`Duplicate attribute: ${n} in ${this.name}`);this.attributes[n]=t.exports.create(e,n,o[n])}}else if("list"===this.type.name){if(o.type){if(!o.list||!o.list[0])throw new i.SchemaError(`No list schema given for attribute: ${this.name}`);o=o.list}for(let n=0;n<o.length;n+=1)this.attributes[n]=t.exports.create(e,0,o[n])}this.options&&(this.applyDefault(this.options.default),this.required=this.options.required,this.options.set&&("function"==typeof this.options.set?this.set=this.options.set:this.options.set.isAsync?this.set=function(t){return new Promise(e=>this.options.set.set(t,t=>e(t)))}:this.set=this.options.set.set),this.options.fromDynamo&&("function"==typeof this.options.fromDynamo?this.parseDynamoCustom=this.options.fromDynamo:this.options.fromDynamo.isAsync?this.parseDynamoCustom=function(t){return new Promise(e=>this.options.fromDynamo.fromDynamo(t,t=>e(t)))}:this.parseDynamoCustom=this.options.fromDynamo.fromDynamo),this.options.toDynamo&&("function"==typeof this.options.toDynamo?this.toDynamoCustom=this.options.toDynamo:this.options.toDynamo.isAsync?this.toDynamoCustom=function(t){return new Promise(e=>this.options.toDynamo.toDynamo(t,t=>e(t)))}:this.toDynamoCustom=this.options.toDynamo.toDynamo),this.options.get&&("function"==typeof this.options.get?this.get=this.options.get:this.options.get.isAsync?this.get=function(t){return new Promise(e=>this.options.get.get(t,t=>e(t)))}:this.get=this.options.get.get),this.applyValidation(this.options.validate),this.applyIndexes(this.options.index))}function s(e){let n;const r={type:t.exports.lookupType(e)};if(r.type===Object)for(n in r.type="map",e){r.map={};for(const t in e[n])r.map[t]=s(e[n][t])}else if(r.type===Array)for(n in r.type="list",e)r.list=e[n].map(s);return r}o.prototype.types={string:{name:"string",dynamo:"S"},number:{name:"number",dynamo:"N"},boolean:{name:"boolean",dynamo:"S",dynamofy:JSON.stringify},nativeBoolean:{name:"boolean",dynamo:"BOOL"},date:{name:"date",dynamo:"N",dynamofy:function(t){return t.getTime||(t=new Date(t)),JSON.stringify(t.getTime())}},object:{name:"object",dynamo:"S",dynamofy:JSON.stringify},array:{name:"array",dynamo:"S",dynamofy:JSON.stringify},map:{name:"map",dynamo:"M",dynamofy:JSON.stringify},list:{name:"list",dynamo:"L",dynamofy:JSON.stringify},buffer:{name:"buffer",dynamo:"B"}},o.prototype.setTypeFromRawValue=function(t){let e,n=t;if(t.type&&(n=t.type),Array.isArray(n)||"list"===n)e="List";else if(Array.isArray(n)&&1===n.length||"function"==typeof n){this.isSet=Array.isArray(n);const t=/^Function ([^(]+)\(/iu,r=n.toString().match(t);[,e]=r,"Object"===e&&(e="Map")}else e="object"==typeof n||"map"===n?"Map":typeof n;if(!e)throw new i.SchemaError(`Invalid attribute type: ${e}`);if(e=e.toLowerCase(),this.type=this.types[e],!this.type)throw new i.SchemaError(`Invalid attribute type: ${e}`)},o.prototype.setType=function(t){if(!t)throw new i.SchemaError(`Invalid attribute value: ${t}`);let e,n=t;if(t.type&&(n=t.type),Array.isArray(n)&&1===n.length&&"object"==typeof n[0])e="List";else if(Array.isArray(n)&&1===n.length||"function"==typeof n){this.isSet=Array.isArray(n);const t=/^Function ([^(]+)\(/iu,r=n.toString().match(t);[,e]=r}else"object"==typeof n?e="Map":"string"==typeof n&&(e=n);if(!e)throw new i.SchemaError(`Invalid attribute type: ${e}`);if(e=e.toLowerCase(),this.type=this.types[e],!this.type)throw new i.SchemaError(`Invalid attribute type: ${e}`)},o.prototype.applyDefault=function(t){null==t?delete this.default:this.default="function"==typeof t?t:function(){return t}},o.prototype.applyValidation=function(t){if(null==t)delete this.validator;else if("function"==typeof t)this.validator=t;else if("RegExp"===t.constructor.name)this.validator=function(e){return t.test(e)};else if("object"==typeof t){const e=t.validator||t.validate;t.isAsync?this.validator=function(n,r){return new Promise(i=>{const o=[n,r];t.disableModelParameter&&o.pop(),e(...o,t=>{i(t)})})}:this.validator=e}else this.validator=function(e){return t===e}},o.prototype.applyIndexes=function(t){if(null==t)return void delete this.indexes;const e=this;function n(t){"object"!=typeof t&&(t={});const n={};if(t.global)if(n.global=!0,t.rangeKey&&(n.rangeKey=t.rangeKey),t.throughput){let{throughput:e}=t;if("number"==typeof e&&(e={read:e,write:e}),n.throughput=e,(!n.throughput.read||!n.throughput.write)&&n.throughput.read>=1&&n.throughput.write>=1)throw new i.SchemaError(`Invalid Index throughput: ${n.throughput}`)}else n.throughput=e.schema.throughput;if(t.name?n.name=t.name:n.name=e.name+(t.global?"GlobalIndex":"LocalIndex"),null!==t.project&&void 0!==t.project?n.project=t.project:n.project=!0,e.indexes[n.name])throw new i.SchemaError(`Duplicate index names: ${n.name}`);e.indexes[n.name]=n}e.indexes={},Array.isArray(t)?t.map(n):n(t)},o.prototype.setDefault=async function(t){if(null==t)return;const e=t[this.name];(null==e||""===e||this.options.forceDefault)&&this.default&&(t[this.name]=await this.default(t),r("Defaulted %s to %s",this.name,t[this.name]))},o.prototype.toDynamo=async function(e,n,o,s){if(this.toDynamoCustom)return this.toDynamoCustom(e,n,o,s);if(null==e||""===e){if(this.required)throw new i.ValidationError(`Required value missing: ${this.name}`);return null}if(!n&&this.isSet){if(!Array.isArray(e))throw new i.ValidationError(`Values must be array: ${this.name}`);if(0===e.length)return null}if(this.validator&&!await this.validator(e,o))throw new i.ValidationError(`Validation failed: ${this.name}`);let a=!0,u=!1,c=!1;o&&o.$__&&o.$__.schema&&o.$__.schema.timestamps&&(o.$__.schema.timestamps.createdAt===this.name||o.$__.schema.timestamps.updatedAt===this.name)&&(c=!0),o&&o.$__&&o.$__.schema&&o.$__.schema.expires&&o.$__.schema.expires.attribute===this.name&&(u=!0),c&&!1===s.updateTimestamps&&(a=!1),u&&!0===s.updateExpires&&(e=await this.default(),a=!0),this.set&&a&&(e=await this.set(e));const{type:p}=this,l={};if(this.isSet&&!n)l[`${p.dynamo}S`]=e.map(t=>p.dynamofy?p.dynamofy(t):(t=t.toString(),"S"===p.dynamo&&(this.options.trim&&(t=t.trim()),this.options.lowercase&&(t=t.toLowerCase()),this.options.uppercase&&(t=t.toUpperCase())),t));else if("map"===p.name){const n={};for(const[r,i]of Object.entries(e)){let e=this.attributes[r];if(!e&&(this.schema.options.saveUnknown||Array.isArray(this.options.saveUnknown)&&this.options.saveUnknown.indexOf(r)>=0)&&(e=t.exports.create(this.schema,r,i),this.attributes[r]=e),e){const t=await e.toDynamo(i);null!=t&&(n[r]=t)}}l.M=n}else if("list"===p.name){if(!Array.isArray(e))throw new i.ValidationError(`Values must be array in a 'list': ${this.name}`);const t=[];for(let n=0;n<e.length;n+=1){const r=e[n],i=this.attributes[0];i&&(await i.setDefault(o),t.push(await i.toDynamo(r,void 0,o)))}l.L=t}else{if(p.dynamofy&&(e=p.dynamofy(e)),"BOOL"===p.dynamo||"B"===p.dynamo&&e instanceof Buffer||(e=e.toString()),"S"===p.dynamo){if(this.options.enum&&-1===this.options.enum.indexOf(e))throw new i.ValidationError(`Value must be one of : ${JSON.stringify(this.options.enum)}`);this.options.trim&&(e=e.trim()),this.options.lowercase&&(e=e.toLowerCase()),this.options.uppercase&&(e=e.toUpperCase())}l[p.dynamo]=e}return r("toDynamo %j",l),l};const a=function(t,e,n){return r('createUnknownAttributeFromDynamo: %j : "%s" : %j',t,e,n),new o(t,e,s(n))};t.exports.createUnknownAttributeFromDynamo=a,o.prototype.parseDynamo=async function(t){if(this.parseDynamoCustom)return this.parseDynamoCustom(t);function e(e,n,r,o){const s=r&&async function(n){try{return await r(n,o)}catch(n){throw n.message+=`\nAttribute "${o.name}" of type "${e}" has an invalid value of ${JSON.stringify(t)}`,new i.ParseError(n.message)}};if(!t)return;if(n){const n=t[`${e}S`];return Promise.all(n.map(t=>s?s(t):t))}const a=t[e];return s?s(void 0===a?t:a):a}let n;switch(this.type.name){case"string":n=await e("S",this.isSet,(function(t){return"string"!=typeof t?(r("******",t),JSON.stringify(t)):t}),this);break;case"number":n=await e("N",this.isSet,JSON.parse,this);break;case"boolean":n=await e(this.type.dynamo,this.isSet,JSON.parse,this);break;case"date":n=await e("N",this.isSet,(function(t){return r("parsing date from %s",t),new Date(parseInt(t,10))}),this);break;case"object":case"array":n=await e("S",this.isSet,JSON.parse,this);break;case"map":n=await e("M",this.isSet,(async function(t,e){if(!t)return;const n={},{attributes:r,schema:o}=e;for(const[s,u]of Object.entries(t)){let t=r[s];if(!t&&o.options.errorUnknown)throw new i.ParseError(`Unknown nested attribute ${s} with value: ${JSON.stringify(u)}`);if(!t&&(o.options.saveUnknown||Array.isArray(o.options.saveUnknown)&&o.options.saveUnknown.indexOf(s)>=0)&&(t=a(o,s,u),e.attributes[s]=t),t){const e=await t.parseDynamo(u);null!=e&&(n[s]=e)}}return n}),this);break;case"list":n=await e("L",this.isSet,(async function(t,e){if(!t)return;const n=[];if(r("parsing list"),Array.isArray(t))for(let r=0;r<t.length;r+=1){const i=e.attributes[0],o=await i.parseDynamo(t[r]);null!=o&&n.push(o)}return n}),this);break;case"buffer":n=await e("B",this.isSet,(function(t){return Buffer.from(t)}),this);break;default:throw new i.SchemaError(`Invalid attribute type: ${this.type}`)}return this.get&&(n=await this.get(n)),r('parseDynamo: %s : "%s" : %j',this.name,this.type.name,n),n},t.exports.create=function(t,e,n){r('create: %j : "%s" : %j',t,e,n);const s=n;let a={};"object"==typeof n&&n.type&&(a=n);const u=new o(t,e,s);if(a.hashKey&&a.rangeKey)throw new i.SchemaError(`Cannot be both hashKey and rangeKey: ${e}`);if((a.hashKey||!t.hashKey&&!a.rangeKey)&&(t.hashKey=u),a.rangeKey&&(t.rangeKey=u),u.indexes)for(const e in u.indexes){const n=u.indexes[e];if(t.indexes.global[e]||t.indexes.local[e])throw new i.SchemaError(`Duplicate index name: ${e}`);n.global?t.indexes.global[e]=u:t.indexes.local[e]=u}return u},t.exports.lookupType=function(t){return null!==t.S&&void 0!==t.S?String:null!==t.L&&void 0!==t.L?Array:null!==t.M&&void 0!==t.M?Object:null!==t.N&&void 0!==t.N?Number:null!==t.BOOL&&void 0!==t.BOOL?Boolean:null!==t.B&&void 0!==t.B?Buffer:null!==t.NS&&void 0!==t.NS?[Number]:void 0}},function(t,e,n){"use strict";const r=n(4)("dynamoose:virtualtype");function i(t,e){this.path=e,this.options=t||{}}i.prototype.get=function(t){return r(`registering getter for ${this.path}`),this.getter=t,this},i.prototype.set=function(t){return r(`registering setter for ${this.path}`),this.setter=t,this},i.prototype.applyVirtuals=function(t){r("applyVirtuals for %s",this.path);const e={enumerable:!0,configurable:!0};this.setter&&(e.set=this.setter),this.getter&&(e.get=this.getter),Object.defineProperty(t,this.path,e)},
/*!
 * exports
 */
t.exports=i},function(t,e,n){"use strict";const r=n(0),i=n(10),o=n(54),s=n(24),a=n(23),u=n(55),c=n(56),p=n(57),l=n(9),h=n(59),f=n(60),d=n(4)("dynamoose:model"),y=Symbol("originalItem");function m(t){this.$__.isNew=!0;for(const e in t)this[e]=t[e]}async function E(t,e,n){if(e.condition){if(t.ConditionExpression?t.ConditionExpression=`(${t.ConditionExpression}) and (${e.condition})`:t.ConditionExpression=e.condition,e.conditionNames){t.ExpressionAttributeNames={};for(const n in e.conditionNames)t.ExpressionAttributeNames[`#${n}`]=e.conditionNames[n]}if(e.conditionValues){t.ExpressionAttributeValues={};const r=Object.keys(e.conditionValues);for(let i=0;i<r.length;i+=1){const o=r[i],s=e.conditionValues[o],a=n.$__.schema.attributes[o];if(!a)throw new l.ModelError(`Invalid condition value: ${o}. The name must either be in the schema or a full DynamoDB object must be specified.`);{const r=e.condition.startsWith("contains");t.ExpressionAttributeValues[`:${o}`]=await a.toDynamo(s,r,n,{updateTimestamps:!1})}}}}}
/*!
* Register virtuals for this model
* @param {Model} model
* @param {Schema} schema
*/function b(t,e,n){if("function"==typeof e&&(n=e),"function"==typeof n)return n(t)}function v(t){return null!=t&&""!==t}async function g(t,e,n,r){const i=e.slice(0);let o=[];const s=[];for(;(o=i.splice(0,n)).length;){const e=await Promise.all(o.map(r)),n={RequestItems:{}};n.RequestItems[t]=e,s.push(n)}return s}function T(t,e){d("batchWriteItems");const n=t.$__,r=e.map(t=>{const e=i.defer();return n.base.ddb().batchWriteItem(t,(t,n)=>{if(t)return d("Error returned by batchWriteItems",t),e.reject(t);e.resolve(n)}),e.promise});return i.all(r).then(t=>function(t){return t.reduce((t,e)=>{const n=e.Responses?e.Responses:{},r=e.UnprocessedItems?e.UnprocessedItems:{};for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){let r=t.Responses[e]?t.Responses[e].ConsumedCapacityUnits:0;r+=n[e].ConsumedCapacityUnits,t.Responses[e]={ConsumedCapacityUnits:r}}for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e)){const n=t.UnprocessedItems[e]?t.UnprocessedItems[e]:[];n.push(r[e]),t.UnprocessedItems[e]=n}return t},{Responses:{},UnprocessedItems:{}})}(t))}m.compile=function(t,e,n,s){d("compiling NewModel %s",t);const u=new a(t,e,n,s);function c(t){m.call(this,t),function(t,e){d("applying virtuals");for(const n in e.virtuals)e.virtuals[n].applyVirtuals(t)}(this,e),this[y]=t}const h=Object.getOwnPropertyDescriptor(c,"name");h.configurable&&(h.value=`Model-${t}`,Object.defineProperty(c,"name",h)),r.inherits(c,m),c.prototype.$__={table:u,base:s,name:t,schema:e,options:n,NewModel:c,plugins:[]},c.$__=c.prototype.$__,c.plugin=function(t,e){const n={event:{plugin:t,pluginOptions:e}};this._emit("plugin:register","pre",n),this.$__.plugins.push(new p(this,t,e,this.plugin.bind(this))),this._emit("plugin:register","post",n)},c.clearAllPlugins=function(){d("Clearing all plugins"),this.$__.plugins=[]},c._emit=async function(t,e,n,r){n||(n={}),n.actions||(n.actions={});for(let i=0;i<this.$__.plugins.length;i+=1){const o=this.$__.plugins[i],s=await o.emit(t,e,n);if(s){if(s.resolve)return r.resolve(s.resolve),!0;if(s.reject)return r.reject(s.reject),!1}}},c.prototype.originalItem=function(){return this[y]},c.prototype.model=function(t){const{models:e}=this.$__.base;if(!Object.prototype.hasOwnProperty.call(e,t)){const e=`Schema hasn't been registered for model "${t}".\nUse dynamoose.model(name, schema)`;throw new l.ModelError(e)}return e[t]},c.get=function(t,e,n){try{return m.get(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.populate=function(t,e,n){try{return m.populate(t,e,n)}catch(e){return b(e,t),i.reject(e)}},c.update=function(t,e,n,r){try{return m.update(c,t,e,n,r)}catch(t){return b(t,n,r),i.reject(t)}},c.delete=function(t,e,n){try{return m.delete(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.query=function(t,e,n){try{return m.query(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.queryOne=function(t,e,n){try{return m.queryOne(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.scan=function(t,e,n){try{return m.scan(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.create=function(t,e,n){try{return m.create(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.batchGet=function(t,e,n){try{return m.batchGet(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.batchPut=function(t,e,n){try{return m.batchPut(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.batchDelete=function(t,e,n){try{return m.batchDelete(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.waitForActive=function(t,e){return u.waitForActive(t,e)},c.getTableReq=function(){return u.buildTableReq(u.name,u.schema)},c.conditionCheck=function(t,e,n){try{return m.conditionCheck(c,t,e,n)}catch(t){return b(t,e,n),i.reject(t)}},c.transaction=[{method:c.get,key:"Get",name:"get",optionsIndex:1},{method:c.delete,key:"Delete",name:"delete",optionsIndex:1},{method:c.create,key:"Put",name:"create",optionsIndex:1},{method:c.update,key:"Update",name:"update",optionsIndex:2},{method:c.conditionCheck,key:"ConditionCheck",name:"conditionCheck",optionsIndex:1}].reduce((t,e)=>{var n,r,i;return t[e.name]=(n=e.method,r=e.key,i=e.optionsIndex,async function(...t){"function"==typeof t[t.length-1]&&(console.warning("Dynamoose Warning: Passing callback function into transaction method not allowed. Removing callback function from list of arguments."),t.pop()),t.length>=i+1?t[i]=Object.assign({},t[i],{returnRequest:!0}):t.length<i?t[i]={returnRequest:!0}:t.push({returnRequest:!0});const e=await n(...t);return"Update"===r&&delete e.ReturnValues,{[r]:e}}),t},{}),function(t,e){d("applying methods");for(const n in e.methods)t.prototype[n]=e.methods[n]}(c,e),function(t,e){d("applying statics");for(const n in e.statics)t[n]=e.statics[n].bind(t)}(c,e);for(const t in o)c[t]=o[t];return u.init(t=>{if(t)throw t}),c},m.conditionCheck=async function(t,e,n,r){d("Condition Check",this);const o=i.defer();try{"function"==typeof(n=n||{})&&(r=n,n={});const{schema:i}=t.$__,s=i.hashKey.name;if(!v(e[s])){const t=e;(e={})[s]=t}if(i.rangeKey&&!v(e[i.rangeKey.name]))return o.reject(new l.ModelError(`Range key required: ${i.rangeKey.name}`)),o.promise.nodeify(r);const a={TableName:t.$__.name,Key:{}};try{a.Key[s]=await i.hashKey.toDynamo(e[s],void 0,e)}catch(t){o.reject(t)}if(i.rangeKey){const t=i.rangeKey.name;a.Key[t]=await i.rangeKey.toDynamo(e[t],void 0,e)}await E(a,n,t),d("Condition Check",a),o.resolve(a)}catch(t){o.reject(t)}return o.promise.nodeify(r)},m.prototype.put=async function(t,e){d("put",this);const n=i.defer(),r={event:{callback:e,options:t,item:this},actions:{updateCallback(t){e=t},updateOptions(e){t=e}}};if(!1===await this.$__.NewModel._emit("model:put","put:called",r,n))return;let o;const s=async()=>{const e={event:{options:t,item:o},actions:{updateItem(t){o=t}}};!1!==await this.$__.NewModel._emit("model:put","request:pre",e,n)&&this.$__.base.ddb().putItem(o,async e=>{const r={event:{options:t,item:o,error:e},actions:{updateError(t){e=t}}};!1!==await this.$__.NewModel._emit("model:put","request:post",r,n)&&(e&&n.reject(e),n.resolve(this))})};try{"function"==typeof(t=t||{})&&(e=t,t={}),null!==t.overwrite&&void 0!==t.overwrite||(t.overwrite=!0);const r={updateTimestamps:!0};!1===t.updateTimestamps&&(r.updateTimestamps=!1),!0===t.updateExpires&&(r.updateExpires=!0);const{schema:i}=this.$__;o={TableName:this.$__.name,Item:await i.toDynamo(this,r)},await i.parseDynamo(this,o.Item),t.overwrite||(h.isReservedKeyword(i.hashKey.name)||i.hashKey.name.startsWith("_")?(o.ConditionExpression="attribute_not_exists(#__hash_key)",o.ExpressionAttributeNames=o.ExpressionAttributeNames||{},o.ExpressionAttributeNames["#__hash_key"]=i.hashKey.name):o.ConditionExpression=`attribute_not_exists(${i.hashKey.name})`),await E(o,t,this),d("putItem",o),t.returnRequest?n.resolve(o):this.$__.options.waitForActive?this.$__.table.waitForActive().then(s).catch(n.reject):s()}catch(t){n.reject(t)}return n.promise.nodeify(e)},m.prototype.save=m.prototype.put,m.create=function(t,e,n,r){return"function"==typeof(n=n||{})&&(r=n,n={}),null!==n.overwrite&&void 0!==n.overwrite||(n.overwrite=!1),new t(e).save(n,r)},m.get=async function(t,e,n,r){d("Get %j",e);const o=i.defer(),s={event:{callback:r,key:e,options:n},actions:{updateCallback(t){r=t},updateKey(t){e=t},updateOptions(t){n=t}}};if(!1===await t._emit("model:get","get:called",s,o))return;if("function"==typeof(n=n||{})&&(r=n,n={}),null==e)return o.reject(new l.ModelError("Key required to get item")),o.promise.nodeify(r);const{schema:a}=t.$__,u=a.hashKey.name;if("object"==typeof e&&!v(e[u]))return o.reject(new l.ModelError(`Hash key required: ${a.hashKey.name}`)),o.promise.nodeify(r);if(!v(e[u])){const t=e;(e={})[u]=t}if(a.rangeKey&&!v(e[a.rangeKey.name]))return o.reject(new l.ModelError(`Range key required: ${a.rangeKey.name}`)),o.promise.nodeify(r);let c={TableName:t.$__.name,Key:{}};try{c.Key[u]=await a.hashKey.toDynamo(e[u],void 0,e)}catch(t){o.reject(t)}if(a.rangeKey){const t=a.rangeKey.name;c.Key[t]=await a.rangeKey.toDynamo(e[t],void 0,e)}n.attributes&&(c.AttributesToGet=n.attributes),n.consistent&&(c.ConsistentRead=!0);const p=t.$__;async function h(){d("getItem",c);const i={event:{callback:r,key:e,options:n,getRequest:c},actions:{updateCallback(t){r=t},updateKey(t){e=t},updateOptions(t){n=t},updateGetRequest(t){c=t}}};!1!==await t._emit("model:get","request:pre",i,o)&&p.base.ddb().getItem(c,async(i,s)=>{const u={event:{callback:r,key:e,options:n,error:i,data:s},actions:{updateCallback(t){r=t},updateKey(t){e=t},updateOptions(t){n=t},updateError(t){i=t},updateData(t){s=t}}};if(!1===await t._emit("model:get","request:post",u,o))return;if(i)return d("Error returned by getItem",i),o.reject(i);if(d("getItem response",s),!Object.keys(s).length)return o.resolve();const c=new t;c.$__.isNew=!1;try{await a.parseDynamo(c,s.Item)}catch(t){return d("cannot parse data",s),o.reject(t)}a.expires&&!1===a.expires.returnExpiredItems&&c[a.expires.attribute]<new Date&&o.resolve(),d("getItem parsed model",c),o.resolve(c)})}return n.returnRequest?o.resolve(c):p.options.waitForActive?p.table.waitForActive().then(h).catch(o.reject):h(),o.promise.nodeify(r)},m.prototype.populate=function(t,e,n){n||(n=[]);const r=e||this;let i="";if("string"==typeof t)i=this.$__.table.schema.attributes[t].options.ref;else if(t.path)i=this.$__.table.schema.attributes[t.path].options.ref;else if(!t.path&&!t.model)throw new Error("Invalid parameters provided to the populate method");const o=Object.keys(this.$__.table.base.models).filter(e=>{const n=this.$__.table.base.models[e];return n.$__.name===n.$__.options.prefix+t.model+n.$__.options.suffix||n.$__.name===n.$__.options.prefix+t.model||n.$__.name===t.model+n.$__.options.suffix||n.$__.name===t.model||n.$__.name===n.$__.options.prefix+i+n.$__.options.suffix||n.$__.name===n.$__.options.prefix+i||n.$__.name===i+n.$__.options.suffix||n.$__.name===i}).pop(),s=this.$__.table.base.models[o];if(!s)throw new Error("The provided model doesn't exists");return s.get(this[t.path||t]).then(e=>{if(!e)throw new Error("Invalid reference");return this[t.path||t]=e,n=n.concat(t.path||t),f.set(r,n,e),t.populate?this[t.path||t].populate(t.populate,r,n):r})},m.update=async function(t,e,n,r,o){d("Update %j",e);const a=i.defer(),{schema:u}=t.$__;"function"==typeof n&&(o=n,n=null),null==n&&(n=e),"function"==typeof(r=r||{})&&(o=r,r={});const c={event:{callback:o,expression:n,options:r,key:e},actions:{updateCallback(t){o=t},updateExpression(t){n=t},updateOptions(t){r=t},updateKey(t){e=t}}};if(!1===await t._emit("model:update","update:called",c,a))return a.promise.nodeify(o);if(void 0===r.createRequired&&(r.createRequired=!1),void 0===r.updateTimestamps&&(r.updateTimestamps=!0),void 0===r.returnValues&&(r.returnValues=t.$__.options.defaultReturnValues||"ALL_NEW"),null==e){e={};const t=u.attributes[u.hashKey.name].options.default;if(void 0===t)return a.reject(new l.ModelError("Key required to get item")),a.promise.nodeify(o);if(e[u.hashKey.name]="function"==typeof t?t():t,u.rangeKey){const t=u.attributes[u.rangeKey.name].options.default;if(void 0===t)return a.reject(new l.ModelError(`Range key required: ${u.rangeKey.name}`)),a.promise.nodeify(o);e[u.rangeKey.name]="function"==typeof t?t():t}}const p=u.hashKey.name;if(!e[p]){const t=e;(e={})[p]=t}let h={TableName:t.$__.name,Key:{},ExpressionAttributeNames:{},ExpressionAttributeValues:{},ReturnValues:r.returnValues};if(await E(h,r,t),h.Key[p]=await u.hashKey.toDynamo(e[p],void 0,e),u.rangeKey){const t=u.rangeKey.name;h.Key[t]=await u.rangeKey.toDynamo(e[t],void 0,e)}const f=new function(){this.ifNotExistsSet={},this.SET={},this.ADD={},this.REMOVE={},this.LISTAPPEND={},this.addIfNotExistsSet=function(t,e){this.ifNotExistsSet[t]=e},this.addSet=function(t,e){u.hashKey.name!==t&&(u.rangeKey||{}).name!==t&&(this.SET[t]=e)},this.addListAppend=function(t,e){u.hashKey.name!==t&&(u.rangeKey||{}).name!==t&&(this.LISTAPPEND[t]=e)},this.addAdd=function(t,e){u.hashKey.name!==t&&(u.rangeKey||{}).name!==t&&(this.ADD[t]=e)},this.addRemove=function(t,e){u.hashKey.name!==t&&(u.rangeKey||{}).name!==t&&(this.REMOVE[t]=e)},this.getUpdateExpression=function(t){let e,n,r,i,o=0,s="";const a=[];for(r in this.ifNotExistsSet)i=this.ifNotExistsSet[r],e=`#_n${o}`,n=`:_p${o}`,t.ExpressionAttributeNames[e]=r,t.ExpressionAttributeValues[n]=i,a.push(`${e} = if_not_exists(${e}, ${n})`),o+=1;for(r in this.SET)i=this.SET[r],e=`#_n${o}`,n=`:_p${o}`,t.ExpressionAttributeNames[e]=r,t.ExpressionAttributeValues[n]=i,a.push(`${e} = ${n}`),o+=1;for(r in this.LISTAPPEND)i=this.LISTAPPEND[r],e=`#_n${o}`,n=`:_p${o}`,t.ExpressionAttributeNames[e]=r,t.ExpressionAttributeValues[n]=i,a.push(`${e} = list_append(${e}, ${n})`),o+=1;a.length>0&&(s+=`SET ${a.join(",")} `);const u=[];for(r in this.ADD)i=this.ADD[r],e=`#_n${o}`,n=`:_p${o}`,t.ExpressionAttributeNames[e]=r,t.ExpressionAttributeValues[n]=i,u.push(`${e} ${n}`),o+=1;u.length>0&&(s+=`ADD ${u.join(",")} `);const c=[];for(r in this.REMOVE)i=this.REMOVE[r],e=`#_n${o}`,t.ExpressionAttributeNames[e]=r,c.push(e),o+=1;c.length>0&&(s+=`REMOVE ${c.join(",")}`),t.UpdateExpression=s}};if(n.$PUT||!n.$PUT&&!n.$DELETE&&!n.$ADD){const t=n.$PUT||n;for(const e in t){const n=u.attributes[e];if(n||u.options.saveUnknown){const i=t[e];let c=null==i||""===i;if(r.allowEmptyArray||(c=c||Array.isArray(i)&&0===i.length),c)f.addRemove(e,null);else try{n?f.addSet(e,await n.toDynamo(i)):u.options.saveUnknown&&f.addSet(e,await s.create(u,e,i).toDynamo(i))}catch(t){return a.reject(t),a.promise.nodeify(o)}}}}if(n.$DELETE)for(const t in n.$DELETE){const e=u.attributes[t];if(e||u.options.saveUnknown){const r=n.$DELETE[t];if(null!=r)try{e?f.addRemove(t,await e.toDynamo(r)):f.addRemove(t,await s.create(u,t,r).toDynamo(r))}catch(t){return a.reject(t),a.promise.nodeify(o)}else f.addRemove(t,null)}}if(n.$ADD)for(const t in n.$ADD){const e=u.attributes[t],r=n.$ADD[t];try{e?"list"===e.type.name?f.addListAppend(t,await e.toDynamo(r)):f.addAdd(t,await e.toDynamo(r)):u.options.saveUnknown&&f.addAdd(t,await s.create(u,t,r).toDynamo(r))}catch(t){return a.reject(t),a.promise.nodeify(o)}}if(r.updateTimestamps&&u.timestamps){const t=u.timestamps.createdAt,e=u.timestamps.updatedAt,n=u.attributes[t],r=u.attributes[e],i=n.options.default(),o=r.options.default();f.addIfNotExistsSet(t,await n.toDynamo(i)),f.addSet(e,await r.toDynamo(o))}if(r.updateExpires&&u.expires){const t=u.expires.attribute,e=u.attributes[t],n=e.options.default();f.addSet(t,await e.toDynamo(n))}if(r.createRequired)for(const t in u.attributes){const e=u.attributes[t];if(e.required&&t!==u.hashKey.name&&(!u.rangeKey||t!==u.rangeKey.name)&&(!u.timestamps||t!==u.timestamps.createdAt)&&(!u.timestamps||t!==u.timestamps.updatedAt)&&!f.SET[t]&&!f.ADD[t]&&!f.REMOVE[t]){const n=e.options.default;if(void 0===n){const e=`Required attribute "${t}" does not have a default.`;return d("Error returned by updateItem",e),a.reject(e),a.promise.nodeify(o)}const r="function"==typeof n?n():n;f.addIfNotExistsSet(t,await e.toDynamo(r))}}f.getUpdateExpression(h),h.UpdateExpression||delete h.UpdateExpression,Object.keys(h.ExpressionAttributeNames).length||delete h.ExpressionAttributeNames,Object.keys(h.ExpressionAttributeValues).length||delete h.ExpressionAttributeValues;const y=t.$__;async function m(){d("updateItem",h);const n={event:{options:r,key:e,request:h},actions:{updateRequest(t){h=t}}};!1!==await t._emit("model:update","request:pre",n,a)&&y.base.ddb().updateItem(h,async(n,i)=>{const o={event:{options:r,key:e,data:i,error:n},actions:{updateData(t){i=t},updateError(t){n=t}}};if(!1===await t._emit("model:update","request:post",o,a))return;if(n)return d("Error returned by updateItem",n),a.reject(n);if(d("updateItem response",i),!Object.keys(i).length)return a.resolve();const s=new t;s.$__.isNew=!1;try{await u.parseDynamo(s,i.Attributes)}catch(t){return d("cannot parse data",i),a.reject(t)}d("updateItem parsed model",s),a.resolve(s)})}return r.returnRequest?a.resolve(h):y.options.waitForActive?y.table.waitForActive().then(m).catch(a.reject):m(),a.promise.nodeify(o)},m.delete=function(t,e,n,r){const{schema:o}=t.$__,s=o.hashKey.name;if(!e[s]){const t=e;(e={})[s]=t}if(o.rangeKey&&!e[o.rangeKey.name]){const t=i.defer();return t.reject(new l.ModelError("Range key required: %s",o.hashKey.name)),t.promise.nodeify(r)}return new t(e).delete(n,r)},m.prototype.delete=async function(t,e){"function"==typeof(t=t||{})&&(e=t,t={});const{schema:n}=this.$__,r=n.hashKey.name,o=i.defer();if(null===this[r]||void 0===this[r])return o.reject(new l.ModelError("Hash key required: %s",r)),o.promise.nodeify(e);if(n.rangeKey&&(null===this[n.rangeKey.name]||void 0===this[n.rangeKey.name]))return o.reject(new l.ModelError("Range key required: %s",n.hashKey.name)),o.promise.nodeify(e);const s={TableName:this.$__.name,Key:{}};try{if(s.Key[r]=await n.hashKey.toDynamo(this[r],void 0,this),n.rangeKey){const t=n.rangeKey.name;s.Key[t]=await n.rangeKey.toDynamo(this[t],void 0,this)}}catch(t){return o.reject(t),o.promise.nodeify(e)}t.update&&(s.ReturnValues="ALL_OLD",s.ConditionExpression=`attribute_exists(${n.hashKey.name})`);const a=()=>{d("deleteItem",s),this.$__.base.ddb().deleteItem(s,async(e,r)=>{if(e)return d("Error returned by deleteItem",e),o.reject(e);if(d("deleteItem response",r),t.update&&r.Attributes)try{await n.parseDynamo(this,r.Attributes),d("deleteItem parsed model",this)}catch(t){return o.reject(t)}o.resolve(this)})};return t.returnRequest?o.resolve(s):this.$__.options.waitForActive?this.$__.table.waitForActive().then(a).catch(o.reject):a(),o.promise.nodeify(e)},m.query=function(t,e,n,r){return"function"==typeof n&&(r=n,n=null),e=new u(t,e,n),r&&e.exec(r),e},m.queryOne=function(t,e,n,r){return"function"==typeof n&&(r=n,n=null),(e=new u(t,e,n)).one(),r&&e.exec(r),e},m.scan=function(t,e,n,r){"function"==typeof n&&(r=n,n=null);const i=new c(t,e,n);return r&&i.exec(r),i},m.batchGet=async function(t,e,n,r){d("BatchGet %j",e);const o=i.defer();if(!Array.isArray(e))return o.reject(new l.ModelError("batchGet requires keys to be an array")),o.promise.nodeify(r);"function"==typeof(n=n||{})&&(r=n,n={});const{schema:s}=t.$__,a=s.hashKey.name;if(e=e.map(t=>{if(!t[a]){const e={};return e[a]=t,e}return t}),s.rangeKey&&!e.every(t=>v(t[s.rangeKey.name])))return o.reject(new l.ModelError(`Range key required: ${s.rangeKey.name}`)),o.promise.nodeify(r);const u={RequestItems:{}},c={};u.RequestItems[t.$__.name]=c,c.Keys=await Promise.all(e.map(async t=>{const e={};if(e[a]=await s.hashKey.toDynamo(t[a],void 0,t),s.rangeKey){const n=s.rangeKey.name;e[n]=await s.rangeKey.toDynamo(t[n],void 0,t)}return e})),n.attributes&&(c.AttributesToGet=n.attributes),n.consistent&&(c.ConsistentRead=!0);const p=t.$__;function h(){d("batchGetItem",u),p.base.ddb().batchGetItem(u,async(e,n)=>{if(e)return d("Error returned by batchGetItem",e),o.reject(e);if(d("batchGetItem response",n),!Object.keys(n).length)return o.resolve();const r=n.Responses[p.name]?(await Promise.all(n.Responses[p.name].map((async function(e){const n=new t;return n.$__.isNew=!1,await s.parseDynamo(n,e),d("batchGet parsed model",n),n})))).filter(t=>!(s.expires&&!1===s.expires.returnExpiredItems&&t[s.expires.attribute]&&t[s.expires.attribute]<new Date)):[];n.UnprocessedKeys[p.name]&&(r.unprocessed=await Promise.all(n.UnprocessedKeys[p.name].Keys.map(async t=>{const e={};if(e[a]=await s.hashKey.parseDynamo(t[a]),s.rangeKey){const n=s.rangeKey.name;e[n]=await s.rangeKey.parseDynamo(t[n])}return e}))),o.resolve(r)})}return p.options.waitForActive?p.table.waitForActive().then(h).catch(o.reject):h(),o.promise.nodeify(r)},m.batchPut=async function(t,e,n,r){d("BatchPut %j",e);const o=i.defer();if("function"==typeof(n=n||{})&&(r=n,n={}),!Array.isArray(e))return o.reject(new l.ModelError("batchPut requires items to be an array")),o.promise.nodeify(r);const s={event:{callback:r,options:n,items:e},actions:{updateCallback(t){r=t},updateOptions(t){n=t}}};if(!1===await t._emit("model:batchput","batchput:called",s,o))return o.promise.nodeify(r);const{schema:a}=t.$__,u=t.$__,c={updateTimestamps:n.updateTimestamps||!1,updateExpires:n.updateExpires||!1},p=await g(u.name,e,25,async t=>({PutRequest:{Item:await a.toDynamo(t,c)}})),h=async function(){const r={event:{options:n,items:p},actions:{updateItems(t){e=t}}};if(!1===await t._emit("model:batchput","request:pre",r,o))return;const i=async(e,r)=>{const i={event:{options:n,items:e,error:r},actions:{updateError(t){r=t}}};!1!==await t._emit("model:batchput","request:post",i,o)&&(r?o.reject(r):o.resolve(e))};T(t,p).then(i).fail(t=>i(null,t))};return u.options.waitForActive?u.table.waitForActive().then(h).catch(o.reject):h(),o.promise.nodeify(r)},m.batchDelete=async function(t,e,n,r){d("BatchDel %j",e);const o=i.defer();if(!Array.isArray(e))return o.reject(new l.ModelError("batchDelete requires keys to be an array")),o.promise.nodeify(r);"function"==typeof(n=n||{})&&(r=n,n={});const{schema:s}=t.$__,a=t.$__,u=s.hashKey.name,c=await g(a.name,e,25,async t=>{const e={};return e[u]=await s.hashKey.toDynamo(t[u],void 0,t),s.rangeKey&&(e[s.rangeKey.name]=await s.rangeKey.toDynamo(t[s.rangeKey.name],void 0,t)),{DeleteRequest:{Key:e}}}),p=function(){T(t,c).then(t=>{o.resolve(t)}).fail(t=>{o.reject(t)})};return a.options.waitForActive?a.table.waitForActive().then(p).catch(o.reject):p(),o.promise.nodeify(r)},t.exports=m,t.exports.originalItemSymbol=y},,,,,,,,,,,function(t,e,n){"use strict";e.a=t=>{const e=[];return["REGION","DYNAMODB_TABLE","GPLAY_ID","ASTORE_ID","HOOK_TABLE"].forEach(n=>{t[n]||e.push(n)}),e}},,,,function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=r(n(17)),o=r(n(42)),s=r(n(4)),a=r(n(10)),u=r(n(23)),c=r(n(53)),p=r(n(26)),l=r(n(25)),h=r(n(9)),f=s.default("dynamoose"),d=s.default("dynamoose:transaction");function y(t){const e={};return e.endpoint=new o.default.Endpoint(t),new o.default.DynamoDB(e)}function m(t,e){const n=t,[r]=Object.keys(t),i=n[r].TableName,o=e.models[i];if(!o){const t=`${i} is not a registered model. You can only use registered Dynamoose models when using a RAW transaction object.`;throw new h.default.TransactionError(t)}const s=o.$__,{schema:a}=s;return{TheModel:o,TheModel$:s,schema:a}}e.createLocalDb=y,e.getModelSchemaFromIndex=m;const E=new class{constructor(){this.models={},this.defaults={create:!0,waitForActive:!0,waitForActiveTimeout:18e4,prefix:"",suffix:""},this.VirtualType=l.default,this.AWS=o.default,this.Schema=c.default,this.Table=u.default,this.Dynamoose=this}model(t,e,n){n=n||{};for(const t in this.defaults)n[t]=void 0===n[t]?this.defaults[t]:n[t];if(t=n.prefix+t+n.suffix,f("Looking up model %s",t),this.models[t])return this.models[t];e instanceof c.default||(e=new c.default(e,n));const r=p.default.compile(t,e,n,this);return this.models[t]=r,r}local(t){this.endpointURL=t||"http://localhost:8000",this.dynamoDB=y(this.endpointURL),f("Setting DynamoDB to local (%s)",this.endpointURL)}documentClient(){return this.dynamoDocumentClient?this.dynamoDocumentClient:(this.endpointURL?(f("Setting dynamodb document client to %s",this.endpointURL),this.AWS.config.update({endpoint:this.endpointURL})):f("Getting default dynamodb document client"),this.dynamoDocumentClient=new this.AWS.DynamoDB.DocumentClient,this.dynamoDocumentClient)}setDocumentClient(t){f("Setting dynamodb document client"),this.dynamoDocumentClient=t}ddb(){return this.dynamoDB?this.dynamoDB:(this.endpointURL?(f("Setting DynamoDB to %s",this.endpointURL),this.dynamoDB=y(this.endpointURL)):(f("Getting default DynamoDB"),this.dynamoDB=new this.AWS.DynamoDB({httpOptions:{agent:new i.default.Agent({rejectUnauthorized:!0,keepAlive:!0})}})),this.dynamoDB)}setDefaults(t){for(const e in this.defaults)t[e]=void 0===t[e]?this.defaults[e]:t[e];this.defaults=t}setDDB(t){f("Setting custom DDB"),this.dynamoDB=t}revertDDB(){f("Reverting to default DDB"),this.dynamoDB=void 0}async transaction(t,e,n){d("Run Transaction");const r=a.default.defer(),i=this.documentClient().createSet([1,2,3]).constructor;let o=e||{};if("function"==typeof e&&(n=e,o={}),!Array.isArray(t)||0===t.length)return r.reject(new h.default.TransactionError("Items required to run transaction")),r.promise.nodeify(n);const s=await Promise.all(t),u={TransactItems:t=s};let c;if(o.type)if(d("Using custom transaction method"),"get"===o.type)c="transactGetItems";else{if("write"!==o.type)return r.reject(new h.default.TransactionError('Invalid type option, please pass in "get" or "write"')),r.promise.nodeify(n);c="transactWriteItems"}else d("Using predetermined transaction method"),c=t.map(t=>Object.keys(t)[0]).every(t=>"Get"===t)?"transactGetItems":"transactWriteItems";d(`Using transaction method: ${c}`);const p=()=>{d("transact",u),this.dynamoDB[c](u,async(e,n)=>e?(d(`Error returned by ${c}`,e),r.reject(e)):(d(`${c} response`,n),n.Responses?r.resolve((await Promise.all(n.Responses.map(async(e,n)=>{const{TheModel:r,schema:o}=m(t[n],this);Object.keys(e).forEach(t=>{e[t]instanceof i&&(e[t]=e[t].values)});const s=new r;return s.$__.isNew=!1,await o.parseDynamo(s,e.Item),d(`${c} parsed model`,s),s}))).filter((e,n)=>{const{schema:r}=m(t[n],this);return!(r.expires&&!1===r.expires.returnExpiredItems&&e[r.expires.attribute]&&e[r.expires.attribute]<new Date)})):r.resolve()))};if(o.returnRequest)r.resolve(u);else if(t.some((e,n)=>m(t[n],this).TheModel.$__.table.options.waitForActive)){Promise.all(t.filter((e,n)=>m(t[n],this).TheModel.$__.table.options.waitForActive).map((e,n)=>m(t[n],this).TheModel.$__.table.waitForActive())).then(p).catch(r.reject)}else p();return r.promise.nodeify(n)}};e.default=E},function(t,e){t.exports=require("aws-sdk")},function(t,e,n){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))}),e.splice(i,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=n(22)(e);const{formatters:r}=t.exports;r.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},function(t,e){var n=1e3,r=6e4,i=36e5,o=24*i;function s(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}t.exports=function(t,e){e=e||{};var a=typeof t;if("string"===a&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var s=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*o;case"hours":case"hour":case"hrs":case"hr":case"h":return s*i;case"minutes":case"minute":case"mins":case"min":case"m":return s*r;case"seconds":case"second":case"secs":case"sec":case"s":return s*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}(t);if("number"===a&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=o)return s(t,e,o,"day");if(e>=i)return s(t,e,i,"hour");if(e>=r)return s(t,e,r,"minute");if(e>=n)return s(t,e,n,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=o)return Math.round(t/o)+"d";if(e>=i)return Math.round(t/i)+"h";if(e>=r)return Math.round(t/r)+"m";if(e>=n)return Math.round(t/n)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},function(t,e,n){const r=n(46),i=n(0);e.init=function(t){t.inspectOpts={};const n=Object.keys(e.inspectOpts);for(let r=0;r<n.length;r++)t.inspectOpts[n[r]]=e.inspectOpts[n[r]]},e.log=function(...t){return process.stderr.write(i.format(...t)+"\n")},e.formatArgs=function(n){const{namespace:r,useColors:i}=this;if(i){const e=this.color,i="[3"+(e<8?e:"8;5;"+e),o=`  ${i};1m${r} [0m`;n[0]=o+n[0].split("\n").join("\n"+o),n.push(i+"m+"+t.exports.humanize(this.diff)+"[0m")}else n[0]=function(){if(e.inspectOpts.hideDate)return"";return(new Date).toISOString()+" "}()+r+" "+n[0]},e.save=function(t){t?process.env.DEBUG=t:delete process.env.DEBUG},e.load=function(){return process.env.DEBUG},e.useColors=function(){return"colors"in e.inspectOpts?Boolean(e.inspectOpts.colors):r.isatty(process.stderr.fd)},e.colors=[6,2,3,4,5,1];try{const t=n(47);t&&(t.stderr||t).level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch(t){}e.inspectOpts=Object.keys(process.env).filter(t=>/^debug_/i.test(t)).reduce((t,e)=>{const n=e.substring(6).toLowerCase().replace(/_([a-z])/g,(t,e)=>e.toUpperCase());let r=process.env[e];return r=!!/^(yes|on|true|enabled)$/i.test(r)||!/^(no|off|false|disabled)$/i.test(r)&&("null"===r?null:Number(r)),t[n]=r,t},{}),t.exports=n(22)(e);const{formatters:o}=t.exports;o.o=function(t){return this.inspectOpts.colors=this.useColors,i.inspect(t,this.inspectOpts).replace(/\s*\n\s*/g," ")},o.O=function(t){return this.inspectOpts.colors=this.useColors,i.inspect(t,this.inspectOpts)}},function(t,e){t.exports=require("tty")},function(t,e,n){"use strict";const r=n(48),i=n(49),o=process.env;let s;function a(t){return function(t){return 0!==t&&{level:t,hasBasic:!0,has256:t>=2,has16m:t>=3}}(function(t){if(!1===s)return 0;if(i("color=16m")||i("color=full")||i("color=truecolor"))return 3;if(i("color=256"))return 2;if(t&&!t.isTTY&&!0!==s)return 0;const e=s?1:0;if("win32"===process.platform){const t=r.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(t[0])>=10&&Number(t[2])>=10586?Number(t[2])>=14931?3:2:1}if("CI"in o)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(t=>t in o)||"codeship"===o.CI_NAME?1:e;if("TEAMCITY_VERSION"in o)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(o.TEAMCITY_VERSION)?1:0;if("truecolor"===o.COLORTERM)return 3;if("TERM_PROGRAM"in o){const t=parseInt((o.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(o.TERM_PROGRAM){case"iTerm.app":return t>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(o.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(o.TERM)?1:"COLORTERM"in o?1:(o.TERM,e)}(t))}i("no-color")||i("no-colors")||i("color=false")?s=!1:(i("color")||i("colors")||i("color=true")||i("color=always"))&&(s=!0),"FORCE_COLOR"in o&&(s=0===o.FORCE_COLOR.length||0!==parseInt(o.FORCE_COLOR,10)),t.exports={supportsColor:a,stdout:a(process.stdout),stderr:a(process.stderr)}},function(t,e){t.exports=require("os")},function(t,e,n){"use strict";t.exports=(t,e)=>{e=e||process.argv;const n=t.startsWith("-")?"":1===t.length?"-":"--",r=e.indexOf(n+t),i=e.indexOf("--");return-1!==r&&(-1===i||r<i)}},function(t,e,n){var r=Array.prototype.slice,i=n(51),o=n(52),s=t.exports=function(t,e,n){return n||(n={}),t===e||(t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():!t||!e||"object"!=typeof t&&"object"!=typeof e?n.strict?t===e:t==e:function(t,e,n){var c,p;if(a(t)||a(e))return!1;if(t.prototype!==e.prototype)return!1;if(o(t))return!!o(e)&&(t=r.call(t),e=r.call(e),s(t,e,n));if(u(t)){if(!u(e))return!1;if(t.length!==e.length)return!1;for(c=0;c<t.length;c++)if(t[c]!==e[c])return!1;return!0}try{var l=i(t),h=i(e)}catch(t){return!1}if(l.length!=h.length)return!1;for(l.sort(),h.sort(),c=l.length-1;c>=0;c--)if(l[c]!=h[c])return!1;for(c=l.length-1;c>=0;c--)if(p=l[c],!s(t[p],e[p],n))return!1;return typeof t==typeof e}(t,e,n))};function a(t){return null==t}function u(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}},function(t,e){function n(t){var e=[];for(var n in t)e.push(n);return e}(t.exports="function"==typeof Object.keys?Object.keys:n).shim=n},function(t,e){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function i(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}(e=t.exports=n?r:i).supported=r,e.unsupported=i},function(t,e,n){"use strict";const r=n(24),i=n(9),o=n(25),{originalItemSymbol:s}=n(26),a=n(4)("dynamoose:schema");function u(t,e){if(a("Creating Schema",t),this.tree={},this.methods={},this.statics={},this.virtuals={},this.options=e||{},this.options.throughput){let{throughput:t}=this.options;"number"==typeof t&&(t={read:t,write:t}),this.throughput=t}else this.throughput={read:1,write:1};if((!this.throughput.read||!this.throughput.write)&&this.throughput.read>=1&&this.throughput.write>=1)throw new i.SchemaError(`Invalid throughput: ${this.throughput}`);if(this.options.timestamps){let e=null,n=null;if(!0===this.options.timestamps)e="createdAt",n="updatedAt";else{if("object"!=typeof this.options.timestamps)throw new i.SchemaError(`Invalid syntax for timestamp: ${this.options.timestamps}`);if(!this.options.timestamps.createdAt||!this.options.timestamps.updatedAt)throw new i.SchemaError("Missing createdAt and updatedAt timestamps attribute. Maybe set timestamps: true?");({createdAt:e,updatedAt:n}=this.options.timestamps)}t[e]=t[e]||{},t[e].type=Date,t[e].default=Date.now,t[n]=t[n]||{},t[n].type=Date,t[n].default=Date.now,t[n].set=function(){return Date.now()},this.timestamps={createdAt:e,updatedAt:n}}if(null!==this.options.expires&&void 0!==this.options.expires){const e={attribute:"expires",returnExpiredItems:!0};if("number"==typeof this.options.expires)e.ttl=this.options.expires;else{if("object"!=typeof this.options.expires)throw new i.SchemaError(`Invalid syntax for expires: ${this.options.expires}`);if("number"!=typeof this.options.expires.ttl)throw new i.SchemaError("Missing or invalided ttl for expires attribute.");e.ttl=this.options.expires.ttl,"string"==typeof this.options.expires.attribute&&(e.attribute=this.options.expires.attribute),"boolean"==typeof this.options.expires.returnExpiredItems&&(e.returnExpiredItems=this.options.expires.returnExpiredItems),"function"==typeof this.options.expires.defaultExpires&&(e.defaultExpires=this.options.expires.defaultExpires)}const n=function(){return new Date(Date.now()+1e3*e.ttl)};t[e.attribute]={type:Number,default:e.defaultExpires||n,set:t=>Math.floor(t.getTime()/1e3),get:t=>new Date(1e3*t)},this.expires=e}this.useDocumentTypes=void 0===this.options.useDocumentTypes||this.options.useDocumentTypes,this.useNativeBooleans=void 0===this.options.useNativeBooleans||this.options.useNativeBooleans,this.attributeFromDynamo=this.options.attributeFromDynamo,this.attributeToDynamo=this.options.attributeToDynamo,this.attributes={},this.indexes={local:{},global:{}};for(const e in t){if(this.attributes[e])throw new i.SchemaError(`Duplicate attribute: ${e}`);a("Adding Attribute to Schema (%s)",e,t),this.attributes[e]=r.create(this,e,t[e])}}u.prototype.toDynamo=async function(t,e){const n={};let i,o;for(o in t)if(Object.prototype.hasOwnProperty.call(t,o)){if(void 0===t[o]||null===t[o]||Number.isNaN(t[o])){a("toDynamo: skipping attribute: %s because its definition or value is null, undefined, or NaN",o);continue}i=this.attributes[o],(!i&&!0===this.options.saveUnknown||Array.isArray(this.options.saveUnknown)&&this.options.saveUnknown.indexOf(o)>=0)&&(i=r.create(this,o,t[o]),this.attributes[o]=i)}for(o in this.attributes){let r;i=this.attributes[o],await i.setDefault(t),r=this.attributeToDynamo?await this.attributeToDynamo(o,t[o],t,i.toDynamo.bind(i),e):await i.toDynamo(t[o],void 0,t,e),r&&(n[i.name]=r)}return a("toDynamo: %s",n),n},u.prototype.parseDynamo=async function(t,e){for(const n in e){let o=this.attributes[n];if(!o&&this.options.errorUnknown){const r=this.hashKey&&this.hashKey.name&&e[this.hashKey.name]&&JSON.stringify(e[this.hashKey.name]),o=this.rangeKey&&this.rangeKey.name&&JSON.stringify(e[this.rangeKey.name]);let s=`Unknown top-level attribute ${n} on model ${t.$__.name} with `;throw r&&(s+=`hash-key ${r} and `),o&&(s+=`range-key ${o} and `),s+=`value: ${JSON.stringify(e[n])}`,new i.ParseError(s)}if((!o&&!0===this.options.saveUnknown||Array.isArray(this.options.saveUnknown)&&this.options.saveUnknown.indexOf(n)>=0)&&(o=r.createUnknownAttributeFromDynamo(this,n,e[n]),this.attributes[n]=o),o){let r;r=this.attributeFromDynamo?await this.attributeFromDynamo(n,e[n],o.parseDynamo.bind(o),t):await o.parseDynamo(e[n]),null!=r&&(t[o.name]=r)}else a("parseDynamo: received an attribute name (%s) that is not defined in the schema",n)}return t.$__&&(t[s]=JSON.parse(JSON.stringify(t,function(){const t=new WeakSet;return(e,n)=>{if("object"==typeof n&&null!==n){if(t.has(n))return;t.add(n)}return n}}()))),a("parseDynamo: %s",t),e},u.prototype.method=function(t,e){if("string"==typeof t)this.methods[t]=e;else for(const e in t)this.methods[e]=t[e];return this},u.prototype.static=function(t,e){if("string"==typeof t)this.statics[t]=e;else for(const e in t)this.statics[e]=t[e];return this},u.prototype.virtual=function(t,e){const n=t.split(".");return this.virtuals[t]=n.reduce((r,i,s)=>r[i]?r[i]:(r[i]=s===n.length-1?new o(e,t):{},r[i]),this.tree),this.virtuals[t]},u.prototype.virtualpath=function(t){return this.virtuals[t]},t.exports=u},function(t,e){function n(t,e){return function n(){if(!n.hookCalled)return n.hookCalled=!0,t.apply(e,arguments)}}t.exports={hook:function(t,e,r){if(1!==arguments.length||"object"!=typeof t){var i=this.prototype||this,o=i._pres=i._pres||{},s=i._posts=i._posts||{};return o[t]=o[t]||[],s[t]=s[t]||[],i[t]=function(){var o,s=this,a=arguments[arguments.length-1],u=this._pres[t],c=this._posts[t],p=u.length,l=-1,h=i[t].numAsyncPres,f=function(){if(arguments[0]instanceof Error)return m(arguments[0]);var e,r,c=Array.prototype.slice.call(arguments);if(!c.length||null==arguments[0]&&"function"==typeof a||(o=c),++l<p){if((e=u[l]).isAsync&&e.length<2)throw new Error("Your pre must have next and done arguments -- e.g., function (next, done, ...)");if(e.length<1)throw new Error("Your pre must have a next argument -- e.g., function (next, ...)");return r=(e.isAsync?[n(f),n(y)]:[n(f)]).concat(o),e.apply(s,r)}return i[t].numAsyncPres?void 0:d.apply(s,o)},d=function(){var t,r,i,u,h=Array.prototype.slice.call(arguments);if(l===p)return u=function(){if(arguments[0]instanceof Error)return m(arguments[0]);var t,e,p=Array.prototype.slice.call(arguments,1);if(p.length&&(o=p),++i<r){if((t=c[i]).length<1)throw new Error("Your post must have a next argument -- e.g., function (next, ...)");return e=[n(u)].concat(o),t.apply(s,e)}return"function"==typeof a?a.apply(s,arguments):void 0},"function"==typeof a&&(h[h.length-1]=n(u)),r=c.length,i=-1,t=e.apply(s,h),r&&"function"!=typeof a?u():t};if(h)function y(t){if(t&&t instanceof Error)return m(t);--h||d.apply(s,o)}function m(t){if("function"==typeof a)return a(t);if(r)return r.call(s,t);throw t}return f.apply(this,arguments)},i[t].numAsyncPres=0,this}for(var a in t)this.hook(a,t[a])},pre:function(t,e,n,r){"boolean"!=typeof arguments[1]&&(r=n,n=e,e=!1);var i=this.prototype||this,o=i._pres=i._pres||{};return this._lazySetupHooks(i,t,r),(n.isAsync=e)&&i[t].numAsyncPres++,(o[t]=o[t]||[]).push(n),this},post:function(t,e,n){2===arguments.length&&(n=e,e=!1);var r=this.prototype||this,i=r._posts=r._posts||{};return this._lazySetupHooks(r,t),(i[t]=i[t]||[]).push(n),this},removePre:function(t,e){var n=this.prototype||this,r=n._pres||n._pres||{};return r[t]?(1===arguments.length?r[t].length=0:r[t]=r[t].filter((function(t){return t!==e})),this):this},_lazySetupHooks:function(t,e,n){void 0===t[e].numAsyncPres&&this.hook(e,t[e],n)}}},function(t,e,n){"use strict";const r=n(10),i=n(9),o=n(4)("dynamoose:query");function s(t,e,n){let r,i;if(this.Model=t,this.options=n||{all:{delay:0,max:1}},this.query={hashKey:{}},this.filters={},this.buildState=!1,this.validationError=null,"string"==typeof e)this.buildState="hashKey",this.query.hashKey.name=e;else if(e.hash){if([r]=Object.keys(e.hash),i=e.hash[r],null!==i.eq&&void 0!==i.eq&&(i=i.eq),this.query.hashKey.name=r,this.query.hashKey.value=i,e.range){const[t]=Object.keys(e.range);let n=e.range[t];const[r]=Object.keys(n);n=n[r],this.query.rangeKey={name:t,values:[n],comparison:r}}}else[r]=Object.keys(e),i=e[r],null!==i.eq&&void 0!==i.eq&&(i=i.eq),this.query.hashKey.name=r,this.query.hashKey.value=i;t._emit("model:query","query:called",{event:{query:this}})}s.prototype.exec=async function(t){o("exec query for ",this.query);const e=this;if(this.Model._emit("model:query","exec:start",{event:{query:this,callback:t},actions:{updateCallback(e){t=e}}}),this.validationError)return t?t(this.validationError):r.reject(this.validationError);const{Model:n,options:i}=this,s=n.$__,{schema:a}=s;o("Query with schema",a);let u,c,p={TableName:n.$__.name,KeyConditions:{}};if(a.hashKey.name!==this.query.hashKey.name||this.query.rangeKey&&a.rangeKey&&a.rangeKey.name!==this.query.rangeKey.name)for(c in a.indexes.global)if(u=a.indexes.global[c],u.name===this.query.hashKey.name&&(!this.query.rangeKey||u.indexes[c].rangeKey===this.query.rangeKey.name)){o("query is on global secondary index"),o("using index",c),p.IndexName=c;break}const l=a.attributes[this.query.hashKey.name];let h,f;if(p.KeyConditions[this.query.hashKey.name]={AttributeValueList:[await l.toDynamo(this.query.hashKey.value)],ComparisonOperator:"EQ"},this.query.rangeKey){const{rangeKey:t}=this.query,e=a.attributes[t.name];if(!p.IndexName&&a.rangeKey.name!==t.name)for(c in o("query is on local secondary index"),a.indexes.local)if(u=a.indexes.local[c],u.name===t.name){o("using local index",c),p.IndexName=c;break}if(t&&void 0!==t.values){o("Range key: %s",t.name),p.KeyConditions[t.name]={AttributeValueList:[],ComparisonOperator:t.comparison.toUpperCase()};const r=p.KeyConditions[t.name];for(h=0;h<t.values.length;h+=1)f=t.values[h],r.AttributeValueList.push(await e.toDynamo(f,!0,n,{updateTimestamps:!1}))}else o("No range key value (i.e. get all)")}if(this.options.indexName&&(o("forcing index: %s",this.options.indexName),p.IndexName=this.options.indexName),this.filters&&Object.keys(this.filters).length>0){p.QueryFilter={};for(const t in this.filters){o("Filter on: %s",t);const e=this.filters[t],r=a.attributes[t];p.QueryFilter[t]={AttributeValueList:[],ComparisonOperator:e.comparison.toUpperCase()};const i=("CONTAINS"===e.comparison||"NOT_CONTAINS"===e.comparison)&&"list"===r.type.name;if(e.values)for(h=0;h<e.values.length;h+=1)f=e.values[h],p.QueryFilter[t].AttributeValueList.push(i?await r.attributes[0].toDynamo(f,!0,n,{updateTimestamps:!1}):await r.toDynamo(f,!0,n,{updateTimestamps:!1}))}}function d(){const u=r.defer();i.all||(i.all={delay:0,max:1});let c,l={},h=0,f=0,d=0;return async function r(){o("DynamoDB Query: %j",p),!1!==await e.Model._emit("model:query","request:pre",{event:{query:e,callback:t,queryReq:p},actions:{updateQueryReq(t){p=t}}},u)&&s.base.ddb().query(p,async(s,y)=>{if(!1!==await e.Model._emit("model:query","request:post",{event:{query:e,callback:t,data:y,error:s},actions:{updateError(t){s=t},updateData(t){y=t}}},u)){if(s)return o("Error returned by query",s),u.reject(s);if(o("DynamoDB Query Response: %j",y),!Object.keys(y).length)return u.resolve();try{if(i.count)return u.resolve(y.Count);if(i.counts){const t={count:y.Count,scannedCount:y.ScannedCount};return u.resolve(t)}if(void 0!==y.Items){if(l.length){const t=await Promise.all(y.Items.map(m));l=l.concat(t)}else l=await Promise.all(y.Items.map(m));if(i.one)return l&&0!==l.length?u.resolve(l.filter(t=>!(a.expires&&!1===a.expires.returnExpiredItems&&t[a.expires.attribute]&&t[a.expires.attribute]<new Date))[0]):u.resolve();c=y.LastEvaluatedKey}d+=y.Count,h+=y.ScannedCount,f+=1,(0===i.all.max||f<i.all.max)&&c?(p.ExclusiveStartKey=c,setTimeout(r,i.all.delay)):(l=l.filter(t=>!(a.expires&&!1===a.expires.returnExpiredItems&&t[a.expires.attribute]&&t[a.expires.attribute]<new Date)),l.lastKey=c,l.count=d,l.scannedCount=h,l.timesQueried=f,u.resolve(l))}catch(t){u.reject(t)}}async function m(t){const e=new n;return e.$__.isNew=!1,await a.parseDynamo(e,t),o("query parsed model",e),e}})}(),u.promise.nodeify(t)}return i.or&&(p.ConditionalOperator="OR"),i.attributes&&(p.AttributesToGet=i.attributes),i.count&&(p.Select="COUNT"),i.counts&&(p.Select="COUNT"),i.consistent&&(p.ConsistentRead=!0),i.limit&&(p.Limit=i.limit),i.one&&(p.Limit=1),i.descending&&(p.ScanIndexForward=!1),i.ExclusiveStartKey&&(p.ExclusiveStartKey=i.ExclusiveStartKey),s.options.waitForActive?s.table.waitForActive().then(d).catch(d):d()},s.prototype.where=function(t){if(this.validationError)return this;if(this.buildState)return this.validationError=new i.QueryError("Invalid Query state: where() must follow eq()"),this;if("string"==typeof t)this.buildState="rangeKey",this.query.rangeKey={name:t};else{const[e]=Object.keys(t);let n=t[e];const[r]=Object.keys(n);n=n[r],this.query.rangeKey={name:e,values:[n],comparison:r}}return this},s.prototype.filter=function(t){if(this.validationError)return this;if(this.buildState)return this.validationError=new i.QueryError("Invalid Query state: filter() must follow comparison"),this;if("string"==typeof t){if(this.buildState="filter",this.currentFilter=t,this.filters[t])return this.validationError=new i.QueryError("Invalid Query state: %s filter can only be used once",t),this;this.filters[t]={name:t}}return this};const a=["EQ","LE","LT","GE","GT","BEGINS_WITH","BETWEEN"];s.prototype.compVal=function(t,e){if(this.validationError)return this;if("hashKey"===this.buildState){if("EQ"!==e)return this.validationError=new i.QueryError("Invalid Query state: eq must follow query()"),this;[this.query.hashKey.value]=t}else if("rangeKey"===this.buildState){if(a.indexOf(e)<0)return this.validationError=new i.QueryError("Invalid Query state: %s must follow filter()",e),this;this.query.rangeKey.values=t,this.query.rangeKey.comparison=e}else{if("filter"!==this.buildState)return this.validationError=new i.QueryError("Invalid Query state: %s must follow query(), where() or filter()",e),this;this.filters[this.currentFilter].values=t,this.filters[this.currentFilter].comparison=e}return this.buildState=!1,this.notState=!1,this},s.prototype.and=function(){return this.options.or=!1,this},s.prototype.or=function(){return this.options.or=!0,this},s.prototype.not=function(){return this.notState=!0,this},s.prototype.null=function(){return this.notState?this.compVal(null,"NOT_NULL"):this.compVal(null,"NULL")},s.prototype.eq=function(t){return this.notState?this.compVal([t],"NE"):this.compVal([t],"EQ")},s.prototype.lt=function(t){return this.notState?this.compVal([t],"GE"):this.compVal([t],"LT")},s.prototype.le=function(t){return this.notState?this.compVal([t],"GT"):this.compVal([t],"LE")},s.prototype.ge=function(t){return this.notState?this.compVal([t],"LT"):this.compVal([t],"GE")},s.prototype.gt=function(t){return this.notState?this.compVal([t],"LE"):this.compVal([t],"GT")},s.prototype.contains=function(t){return this.notState?this.compVal([t],"NOT_CONTAINS"):this.compVal([t],"CONTAINS")},s.prototype.beginsWith=function(t){return this.validationError?this:this.notState?(this.validationError=new i.QueryError("Invalid Query state: beginsWith() cannot follow not()"),this):this.compVal([t],"BEGINS_WITH")},s.prototype.in=function(t){return this.validationError?this:this.notState?(this.validationError=new i.QueryError("Invalid Query state: in() cannot follow not()"),this):this.compVal(t,"IN")},s.prototype.between=function(t,e){return this.validationError?this:this.notState?(this.validationError=new i.QueryError("Invalid Query state: between() cannot follow not()"),this):this.compVal([t,e],"BETWEEN")},s.prototype.limit=function(t){return this.options.limit=t,this},s.prototype.one=function(){return this.options.one=!0,this},s.prototype.consistent=function(){return this.options.consistent=!0,this},s.prototype.descending=function(){return this.options.descending=!0,this},s.prototype.ascending=function(){return this.options.descending=!1,this},s.prototype.startAt=function(t){return this.options.ExclusiveStartKey=t,this},s.prototype.attributes=function(t){return this.options.attributes=t,this},s.prototype.count=function(){return this.options.count=!0,this.options.select="COUNT",this},s.prototype.counts=function(){return this.options.counts=!0,this.options.select="COUNT",this},s.prototype.using=function(t){return this.options.indexName=t,this},s.prototype.all=function(t,e){return t=t||1e3,e=e||0,this.options.all={delay:t,max:e},this},t.exports=s},function(t,e,n){"use strict";const r=n(10),i=n(4)("dynamoose:scan"),o=n(9);function s(t,e,n){this.Model=t,this.options=n||{all:{delay:0,max:1}},this.filters={},this.buildState=!1,this.validationError=null,"string"==typeof e?(this.buildState=e,this.filters[e]={name:e}):"object"==typeof e&&("string"==typeof e.FilterExpression?this.filters=e:this.parseFilterObject(e)),t._emit("model:scan","scan:called",{event:{scan:this}})}s.prototype.exec=async function(t){i("exec scan for ",this.scan);const e=this;if(this.Model._emit("model:scan","exec:start",{event:{scan:this,callback:t},actions:{updateCallback(e){t=e}}}),this.validationError)return t?t(this.validationError):r.reject(this.validationError);const{Model:n,options:o}=this,s=n.$__,{schema:a}=s,u=r.defer();let c={};async function p(t){const e=new n;return e.$__.isNew=!1,await a.parseDynamo(e,t),i("scan parsed model",e),e}if(this.filters&&"string"==typeof this.filters.FilterExpression)return c=this.filters,c||(c={}),c.TableName||(c.TableName=n.$__.name),function(){const e=r.defer(),o=n.$__.base.documentClient(),s=o.createSet([1,2,3]).constructor;return o.scan(c,(t,r)=>{if(t)return e.reject(t);if(!r)return e.resolve([]);if(!r.Items){const t={count:r.Count,scannedCount:r.ScannedCount};return e.resolve(t)}const o=r.Items.map(t=>{Object.keys(t).forEach(e=>{t[e]instanceof s&&(t[e]=t[e].values)});const e=new n(t);return e.$__.isNew=!1,i("scan parsed model",e),e}).filter(t=>!(a.expires&&!1===a.expires.returnExpiredItems&&t[a.expires.attribute]&&t[a.expires.attribute]<new Date));return o.lastKey=r.LastEvaluatedKey,o.count=r.Count,o.scannedCount=r.ScannedCount,e.resolve(o)}),e.promise.nodeify(t)}();if(c={TableName:n.$__.name},Object.keys(this.filters).length>0){c.ScanFilter={};for(const t in this.filters){const e=this.filters[t],r=a.attributes[t];c.ScanFilter[t]={AttributeValueList:[],ComparisonOperator:e.comparison};const i=("CONTAINS"===e.comparison||"NOT_CONTAINS"===e.comparison)&&"list"===r.type.name;if(e.values)for(let o=0;o<e.values.length;o+=1){const s=e.values[o];c.ScanFilter[t].AttributeValueList.push(i?await r.attributes[0].toDynamo(s,!0,n,{updateTimestamps:!1}):await r.toDynamo(s,!0,n,{updateTimestamps:!1}))}}}function l(s){const l=r.defer();let h=Object.assign({},c);h.TotalSegments&&(h.Segment=s),o.ExclusiveStartKey&&(h.ExclusiveStartKey=o.ExclusiveStartKey[s]),i("adding scan segement",h);let f,d={},y=0,m=0,E=0;return o.all||(o.all={delay:0,max:1}),async function r(){i("scan request",h),!1!==await e.Model._emit("model:scan","request:pre",{event:{scan:e,callback:t,scanReq:h},actions:{updateScanReq(t){h=t}}},u)&&e.Model.$__.base.ddb().scan(h,async(s,c)=>{if(!1!==await n._emit("model:scan","request:post",{event:{scan:e,callback:t,data:c,error:s},actions:{updateError(t){s=t},updateData(t){c=t}}},u)){if(s)return i("Error returned by scan",s),l.reject(s);if(i("scan response",c),!Object.keys(c).length)return l.resolve();try{if(o.count)return l.resolve(c.Count);if(o.counts){const t={count:c.Count,scannedCount:c.ScannedCount};return l.resolve(t)}if(void 0!==c.Items){if(d.length&&0!==d.length){const t=await Promise.all(c.Items.map(p));d=d.concat(t)}else d=await Promise.all(c.Items.map(p));if(o.one)return d&&0!==d.length?l.resolve(d.filter(t=>!(a.expires&&!1===a.expires.returnExpiredItems&&t[a.expires.attribute]&&t[a.expires.attribute]<new Date))[0]):l.resolve();f=c.LastEvaluatedKey}E+=c.Count,y+=c.ScannedCount,m+=1,(0===o.all.max||m<o.all.max)&&f?(h.ExclusiveStartKey=f,setTimeout(r,o.all.delay)):(d=d.filter(t=>!(a.expires&&!1===a.expires.returnExpiredItems&&t[a.expires.attribute]&&t[a.expires.attribute]<new Date)),d.lastKey=f,d.count=E,d.scannedCount=y,d.timesScanned=m,l.resolve(d))}catch(t){l.reject(t)}}})}(),l.promise}function h(){const e=c.TotalSegments||1,n=[];for(let t=0;t<e;t+=1)n.push(l(t));return r.all(n).then(t=>{let e=t.reduce((t,e)=>t.concat(e),[]);e=e.filter(t=>!(a.expires&&!1===a.expires.returnExpiredItems&&t[a.expires.attribute]&&t[a.expires.attribute]<new Date));const n=t.map(t=>t.lastKey);1===n.length?[e.lastKey]=n:0!==n.filter(t=>t).length&&(e.lastKey=n),e.count=t.reduce((t,e)=>t+e.count,0),e.scannedCount=t.reduce((t,e)=>t+e.scannedCount,0),e.timesScanned=t.reduce((t,e)=>t+e.timesScanned,0),u.resolve(e)}).fail(t=>{u.reject(t)}),u.promise.nodeify(t)}return o.attributes&&(c.AttributesToGet=o.attributes),o.count&&(c.Select="COUNT"),o.counts&&(c.Select="COUNT"),o.limit&&(c.Limit=o.limit),o.parallel&&(c.TotalSegments=o.parallel),Array.isArray(o.ExclusiveStartKey)?c.TotalSegments=o.ExclusiveStartKey.length:o.ExclusiveStartKey&&(o.ExclusiveStartKey=[o.ExclusiveStartKey]),o.conditionalOperator&&(c.ConditionalOperator=o.conditionalOperator),o.consistent&&(c.ConsistentRead=!0),o.indexName&&(i("using index: %s",this.options.indexName),c.IndexName=this.options.indexName),s.options.waitForActive?s.table.waitForActive().then(h).catch(e=>t?t(e):r.reject(e)):h()},s.prototype.parseFilterObject=function(t){if(Object.keys(t).length>0)for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))if("and"===e||"or"===e){this[e]();for(const n in t[e])Object.prototype.hasOwnProperty.call(t[e],n)&&this.parseFilterObject(t[e][n])}else{let n,r;this.where(e),"object"==typeof t[e]&&1===Object.keys(t[e]).length?([n]=Object.keys(t[e]),"null"===n?(t[e][n]||(n="not_null"),r=[null]):r="in"===n||"between"===n?t[e][n]:[t[e][n]]):(n="eq",r=[t[e]]),this.compVal(r,n.toUpperCase())}},s.prototype.and=function(){return this.options.conditionalOperator="AND",this},s.prototype.or=function(){return this.options.conditionalOperator="OR",this},s.prototype.consistent=function(){return this.options.consistent=!0,this},s.prototype.where=function(t){if(this.validationError)return this;if(this.buildState)return this.validationError=new o.ScanError("Invalid scan state; where() must follow comparison"),this;if("string"==typeof t){if(this.buildState=t,this.filters[t])return this.validationError=new o.ScanError("Invalid scan state; %s can only be used once",t),this;this.filters[t]={name:t}}return this},s.prototype.filter=s.prototype.where,s.prototype.compVal=function(t,e){if(this.validationError)return this;return this.buildState?-1===["NOT_NULL","NULL","EQ","NE","GE","LT","GT","LE","GE","NOT_CONTAINS","CONTAINS","BEGINS_WITH","IN","BETWEEN"].indexOf(e)?(this.validationError=new o.ScanError("Invalid comparison %s",e),this):(this.filters[this.buildState].values=t,this.filters[this.buildState].comparison=e,this.buildState=!1,this.notState=!1,this):(this.validationError=new o.ScanError("Invalid scan state; %s must follow scan(), where(), or filter()",e),this)},s.prototype.not=function(){return this.notState=!0,this},s.prototype.null=function(){return this.notState?this.compVal(null,"NOT_NULL"):this.compVal(null,"NULL")},s.prototype.eq=function(t){return""===t||null==t?this.null():this.notState?this.compVal([t],"NE"):this.compVal([t],"EQ")},s.prototype.lt=function(t){return this.notState?this.compVal([t],"GE"):this.compVal([t],"LT")},s.prototype.le=function(t){return this.notState?this.compVal([t],"GT"):this.compVal([t],"LE")},s.prototype.ge=function(t){return this.notState?this.compVal([t],"LT"):this.compVal([t],"GE")},s.prototype.gt=function(t){return this.notState?this.compVal([t],"LE"):this.compVal([t],"GT")},s.prototype.contains=function(t){return this.notState?this.compVal([t],"NOT_CONTAINS"):this.compVal([t],"CONTAINS")},s.prototype.beginsWith=function(t){return this.validationError?this:this.notState?(this.validationError=new o.ScanError("Invalid scan state: beginsWith() cannot follow not()"),this):this.compVal([t],"BEGINS_WITH")},s.prototype.in=function(t){return this.validationError?this:this.notState?(this.validationError=new o.ScanError("Invalid scan state: in() cannot follow not()"),this):this.compVal(t,"IN")},s.prototype.between=function(t,e){return this.validationError?this:this.notState?(this.validationError=new o.ScanError("Invalid scan state: between() cannot follow not()"),this):this.compVal([t,e],"BETWEEN")},s.prototype.limit=function(t){return this.options.limit=t,this},s.prototype.startAt=function(t){return this.options.ExclusiveStartKey=t,this},s.prototype.attributes=function(t){return this.options.attributes=t,this},s.prototype.count=function(){return this.options.count=!0,this.options.select="COUNT",this},s.prototype.counts=function(){return this.options.counts=!0,this.options.select="COUNT",this},s.prototype.using=function(t){return this.options.indexName=t,this},s.prototype.all=function(t,e){return t=t||1e3,e=e||0,this.options.all={delay:t,max:e},this},s.prototype.parallel=function(t){return this.options.parallel=t,this},t.exports=s},function(t,e,n){"use strict";const r=n(4)("dynamoose:plugin"),i=n(58);function o(t,e,n,o){this.name="",this.description="",this.listeners=[],this._model=t,this.registerPlugin=o,e({setName:t=>{this.name=t,r(`Set plugin name to ${t}`)},setDescription:t=>{this.description=t,r(`Set description to ${t}`)},on:(t,e,n)=>{"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),"*"===t&&(t=null),"*"===e&&(e=null),this.listeners.push(new i(t,e,n,this))}},n),this.emit("plugin","init")}o.prototype.emit=async function(t,e,n){r("Received emit"),r(`Type: ${t}`),r(`Stage: ${e}`),r("Filtering listeners that match type and stage");const i=this.listeners.filter(n=>!(n.type&&n.type!==t||n.stage&&n.stage!==e));n||(n={}),n.actions||(n.actions={}),n.actions.registerPlugin=this.registerPlugin,n.model=this._model,n.modelName=this._model.$__.name,n.plugins=this._model.$__.plugins,n.plugin=this;for(let r=0;r<i.length;r+=1){const o=i[r],s=await o.emit(t,e,n);if(s&&(s.resolve||s.reject))return s}},t.exports=o},function(t,e,n){"use strict";const r=n(4);function i(t,e,n,i){this.type=t,this.stage=e,this.func=n;const o=i.name&&""!==i.name?i.name:"unnamed-plugin";this._debug=r(`dynamoose:${o}:listener`)}i.prototype.emit=async function(t,e,n){this._debug("Received emit"),n.event||(n.event={}),n.event.type=t,n.event.stage=e;try{return await this.func(n)}catch(t){this._debug(`Error running emit on plugin ${n.plugin.name}`)}},t.exports=i},function(t,e,n){"use strict";const r=["ABORT","ABSOLUTE","ACTION","ADD","AFTER","AGENT","AGGREGATE","ALL","ALLOCATE","ALTER","ANALYZE","AND","ANY","ARCHIVE","ARE","ARRAY","AS","ASC","ASCII","ASENSITIVE","ASSERTION","ASYMMETRIC","AT","ATOMIC","ATTACH","ATTRIBUTE","AUTH","AUTHORIZATION","AUTHORIZE","AUTO","AVG","BACK","BACKUP","BASE","BATCH","BEFORE","BEGIN","BETWEEN","BIGINT","BINARY","BIT","BLOB","BLOCK","BOOLEAN","BOTH","BREADTH","BUCKET","BULK","BY","BYTE","CALL","CALLED","CALLING","CAPACITY","CASCADE","CASCADED","CASE","CAST","CATALOG","CHAR","CHARACTER","CHECK","CLASS","CLOB","CLOSE","CLUSTER","CLUSTERED","CLUSTERING","CLUSTERS","COALESCE","COLLATE","COLLATION","COLLECTION","COLUMN","COLUMNS","COMBINE","COMMENT","COMMIT","COMPACT","COMPILE","COMPRESS","CONDITION","CONFLICT","CONNECT","CONNECTION","CONSISTENCY","CONSISTENT","CONSTRAINT","CONSTRAINTS","CONSTRUCTOR","CONSUMED","CONTINUE","CONVERT","COPY","CORRESPONDING","COUNT","COUNTER","CREATE","CROSS","CUBE","CURRENT","CURSOR","CYCLE","DATA","DATABASE","DATE","DATETIME","DAY","DEALLOCATE","DEC","DECIMAL","DECLARE","DEFAULT","DEFERRABLE","DEFERRED","DEFINE","DEFINED","DEFINITION","DELETE","DELIMITED","DEPTH","DEREF","DESC","DESCRIBE","DESCRIPTOR","DETACH","DETERMINISTIC","DIAGNOSTICS","DIRECTORIES","DISABLE","DISCONNECT","DISTINCT","DISTRIBUTE","DO","DOMAIN","DOUBLE","DROP","DUMP","DURATION","DYNAMIC","EACH","ELEMENT","ELSE","ELSEIF","EMPTY","ENABLE","END","EQUAL","EQUALS","ERROR","ESCAPE","ESCAPED","EVAL","EVALUATE","EXCEEDED","EXCEPT","EXCEPTION","EXCEPTIONS","EXCLUSIVE","EXEC","EXECUTE","EXISTS","EXIT","EXPLAIN","EXPLODE","EXPORT","EXPRESSION","EXTENDED","EXTERNAL","EXTRACT","FAIL","FALSE","FAMILY","FETCH","FIELDS","FILE","FILTER","FILTERING","FINAL","FINISH","FIRST","FIXED","FLATTERN","FLOAT","FOR","FORCE","FOREIGN","FORMAT","FORWARD","FOUND","FREE","FROM","FULL","FUNCTION","FUNCTIONS","GENERAL","GENERATE","GET","GLOB","GLOBAL","GO","GOTO","GRANT","GREATER","GROUP","GROUPING","HANDLER","HASH","HAVE","HAVING","HEAP","HIDDEN","HOLD","HOUR","IDENTIFIED","IDENTITY","IF","IGNORE","IMMEDIATE","IMPORT","IN","INCLUDING","INCLUSIVE","INCREMENT","INCREMENTAL","INDEX","INDEXED","INDEXES","INDICATOR","INFINITE","INITIALLY","INLINE","INNER","INNTER","INOUT","INPUT","INSENSITIVE","INSERT","INSTEAD","INT","INTEGER","INTERSECT","INTERVAL","INTO","INVALIDATE","IS","ISOLATION","ITEM","ITEMS","ITERATE","JOIN","KEY","KEYS","LAG","LANGUAGE","LARGE","LAST","LATERAL","LEAD","LEADING","LEAVE","LEFT","LENGTH","LESS","LEVEL","LIKE","LIMIT","LIMITED","LINES","LIST","LOAD","LOCAL","LOCALTIME","LOCALTIMESTAMP","LOCATION","LOCATOR","LOCK","LOCKS","LOG","LOGED","LONG","LOOP","LOWER","MAP","MATCH","MATERIALIZED","MAX","MAXLEN","MEMBER","MERGE","METHOD","METRICS","MIN","MINUS","MINUTE","MISSING","MOD","MODE","MODIFIES","MODIFY","MODULE","MONTH","MULTI","MULTISET","NAME","NAMES","NATIONAL","NATURAL","NCHAR","NCLOB","NEW","NEXT","NO","NONE","NOT","NULL","NULLIF","NUMBER","NUMERIC","OBJECT","OF","OFFLINE","OFFSET","OLD","ON","ONLINE","ONLY","OPAQUE","OPEN","OPERATOR","OPTION","OR","ORDER","ORDINALITY","OTHER","OTHERS","OUT","OUTER","OUTPUT","OVER","OVERLAPS","OVERRIDE","OWNER","PAD","PARALLEL","PARAMETER","PARAMETERS","PARTIAL","PARTITION","PARTITIONED","PARTITIONS","PATH","PERCENT","PERCENTILE","PERMISSION","PERMISSIONS","PIPE","PIPELINED","PLAN","POOL","POSITION","PRECISION","PREPARE","PRESERVE","PRIMARY","PRIOR","PRIVATE","PRIVILEGES","PROCEDURE","PROCESSED","PROJECT","PROJECTION","PROPERTY","PROVISIONING","PUBLIC","PUT","QUERY","QUIT","QUORUM","RAISE","RANDOM","RANGE","RANK","RAW","READ","READS","REAL","REBUILD","RECORD","RECURSIVE","REDUCE","REF","REFERENCE","REFERENCES","REFERENCING","REGEXP","REGION","REINDEX","RELATIVE","RELEASE","REMAINDER","RENAME","REPEAT","REPLACE","REQUEST","RESET","RESIGNAL","RESOURCE","RESPONSE","RESTORE","RESTRICT","RESULT","RETURN","RETURNING","RETURNS","REVERSE","REVOKE","RIGHT","ROLE","ROLES","ROLLBACK","ROLLUP","ROUTINE","ROW","ROWS","RULE","RULES","SAMPLE","SATISFIES","SAVE","SAVEPOINT","SCAN","SCHEMA","SCOPE","SCROLL","SEARCH","SECOND","SECTION","SEGMENT","SEGMENTS","SELECT","SELF","SEMI","SENSITIVE","SEPARATE","SEQUENCE","SERIALIZABLE","SESSION","SET","SETS","SHARD","SHARE","SHARED","SHORT","SHOW","SIGNAL","SIMILAR","SIZE","SKEWED","SMALLINT","SNAPSHOT","SOME","SOURCE","SPACE","SPACES","SPARSE","SPECIFIC","SPECIFICTYPE","SPLIT","SQL","SQLCODE","SQLERROR","SQLEXCEPTION","SQLSTATE","SQLWARNING","START","STATE","STATIC","STATUS","STORAGE","STORE","STORED","STREAM","STRING","STRUCT","STYLE","SUB","SUBMULTISET","SUBPARTITION","SUBSTRING","SUBTYPE","SUM","SUPER","SYMMETRIC","SYNONYM","SYSTEM","TABLE","TABLESAMPLE","TEMP","TEMPORARY","TERMINATED","TEXT","THAN","THEN","THROUGHPUT","TIME","TIMESTAMP","TIMEZONE","TINYINT","TO","TOKEN","TOTAL","TOUCH","TRAILING","TRANSACTION","TRANSFORM","TRANSLATE","TRANSLATION","TREAT","TRIGGER","TRIM","TRUE","TRUNCATE","TTL","TUPLE","TYPE","UNDER","UNDO","UNION","UNIQUE","UNIT","UNKNOWN","UNLOGGED","UNNEST","UNPROCESSED","UNSIGNED","UNTIL","UPDATE","UPPER","URL","USAGE","USE","USER","USERS","USING","UUID","VACUUM","VALUE","VALUED","VALUES","VARCHAR","VARIABLE","VARIANCE","VARINT","VARYING","VIEW","VIEWS","VIRTUAL","VOID","WAIT","WHEN","WHENEVER","WHERE","WHILE","WINDOW","WITH","WITHIN","WITHOUT","WORK","WRAPPED","WRITE","YEAR","ZONE"].reduce((t,e)=>(t[e.toUpperCase()]=!0,t),{});t.exports.RESRVED_KEYWORDS=r,e.isReservedKeyword=function(t){return"string"==typeof t&&Boolean(r[t.toUpperCase()])}},function(t,e,n){var r,i,o;!function(n,s){"use strict";"object"==typeof t.exports?t.exports=s():(i=[],void 0===(o="function"==typeof(r=s)?r.apply(e,i):r)||(t.exports=o))}(0,(function(){"use strict";var t=Object.prototype.toString;function e(t,e){return null!=t&&Object.prototype.hasOwnProperty.call(t,e)}function n(t){if(!t)return!0;if(i(t)&&0===t.length)return!0;if("string"!=typeof t){for(var n in t)if(e(t,n))return!1;return!0}return!1}function r(e){return t.call(e)}var i=Array.isArray||function(e){return"[object Array]"===t.call(e)};function o(t){var e=parseInt(t);return e.toString()===t?e:t}function s(t){t=t||{};var s=function(t){return Object.keys(s).reduce((function(e,n){return"create"===n?e:("function"==typeof s[n]&&(e[n]=s[n].bind(s,t)),e)}),{})};function a(n,r){return t.includeInheritedProps||"number"==typeof r&&Array.isArray(n)||e(n,r)}function u(t,e){if(a(t,e))return t[e]}function c(t,e,n,r){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if("string"==typeof e)return c(t,e.split(".").map(o),n,r);var i=e[0],s=u(t,i);return 1===e.length?(void 0!==s&&r||(t[i]=n),s):(void 0===s&&("number"==typeof e[1]?t[i]=[]:t[i]={}),c(t[i],e.slice(1),n,r))}return s.has=function(n,r){if("number"==typeof r?r=[r]:"string"==typeof r&&(r=r.split(".")),!r||0===r.length)return!!n;for(var s=0;s<r.length;s++){var a=o(r[s]);if(!("number"==typeof a&&i(n)&&a<n.length||(t.includeInheritedProps?a in Object(n):e(n,a))))return!1;n=n[a]}return!0},s.ensureExists=function(t,e,n){return c(t,e,n,!0)},s.set=function(t,e,n,r){return c(t,e,n,r)},s.insert=function(t,e,n,r){var o=s.get(t,e);r=~~r,i(o)||(o=[],s.set(t,e,o)),o.splice(r,0,n)},s.empty=function(t,e){var o,u;if(!n(e)&&(null!=t&&(o=s.get(t,e)))){if("string"==typeof o)return s.set(t,e,"");if(function(t){return"boolean"==typeof t||"[object Boolean]"===r(t)}(o))return s.set(t,e,!1);if("number"==typeof o)return s.set(t,e,0);if(i(o))o.length=0;else{if(!function(t){return"object"==typeof t&&"[object Object]"===r(t)}(o))return s.set(t,e,null);for(u in o)a(o,u)&&delete o[u]}}},s.push=function(t,e){var n=s.get(t,e);i(n)||(n=[],s.set(t,e,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},s.coalesce=function(t,e,n){for(var r,i=0,o=e.length;i<o;i++)if(void 0!==(r=s.get(t,e[i])))return r;return n},s.get=function(t,e,n){if("number"==typeof e&&(e=[e]),!e||0===e.length)return t;if(null==t)return n;if("string"==typeof e)return s.get(t,e.split("."),n);var r=o(e[0]),i=u(t,r);return void 0===i?n:1===e.length?i:s.get(t[r],e.slice(1),n)},s.del=function(t,e){if("number"==typeof e&&(e=[e]),null==t)return t;if(n(e))return t;if("string"==typeof e)return s.del(t,e.split("."));var r=o(e[0]);return a(t,r)?1!==e.length?s.del(t[r],e.slice(1)):(i(t)?t.splice(r,1):delete t[r],t):t},s}var a=s();return a.create=s,a.withInheritedProps=s({includeInheritedProps:!0}),a}))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";n.r(e),n.d(e,"handler",(function(){return o}));var r=n(37),i=n(21);const o=async t=>{const e=process.env.DYNAMODB_TABLE,n=Object(r.a)(process.env);if(n.length){const t=n.join(", ");return a(500,{message:`Missing required environment variables: ${t}`})}const i=await s(e);return a(200,{versions:i})},s=t=>new Promise((e,n)=>{Object(i.a)(t).scan().exec((t,r)=>{if(t)return n(t);e(r)})}),a=async(t,e)=>({statusCode:t,body:JSON.stringify(e)})}]));